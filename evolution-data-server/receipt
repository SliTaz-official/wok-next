# SliTaz package receipt v2.

PACKAGE="evolution-data-server"
VERSION="2.28.1"
CATEGORY="network"
SHORT_DESC="Integrated mail, addressbook and calendaring, server"
MAINTAINER="erjo@slitaz.org"
LICENSE="LGPL2"
WEB_SITE="http://projects.gnome.org/evolution/download.shtml"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="$GNOME_MIRROR/$PACKAGE/${VERSION%.*}/$TARBALL"

BUILD_DEPENDS="libglade-dev libsoup-dev gtk+-dev orbit2-dev libbonobo-dev \
GConf-dev libical-dev firefox-dev db-dev xorg-libxcb-dev popt-dev bison flex \
glib-dev sqlite3-dev"
SPLIT="evolution-data-server-dev"

compile_rules() {
	./configure \
		--prefix=/usr \
		--infodir=/usr/share/info \
		--libexecdir=/usr/lib/evolution-data-server-1.2 \
		--mandir=/usr/share/man \
		--without-weather \
		--enable-ipv6=no \
		--enable-libdb \
		--with-db=/usr/lib \
		--with-nspr-include=/usr/include/firefox-3.5.3/stable \
		--with-nspr-libs=/usr/lib/firefox-devel-3.5.3/sdk/lib \
		$CONFIGURE_ARGS &&
	make && make DESTDIR=$DESTDIR install
}

genpkg_rules() {
	case $PACKAGE in
		evolution-data-server)
			mkdir -p $fs/usr/lib $fs/usr/share

			cp -a $install/usr/share/pixmaps $fs/usr/share
			cp -a $install/usr/share/evolution-data-server-2.28 $fs/usr/share
			cp -a $install/usr/share/idl $fs/usr/share

			cp -a $install/usr/lib/bonobo $fs/usr/lib
			cp -a $install/usr/lib/*.so* $fs/usr/lib
			cp -a $install/usr/lib/evolution-data-server-1.2 $fs/usr/lib

			# Clean unwated files
			cd $fs/usr/lib  ; find . -name "*.*a" -exec rm -f {} \;

			# Stripping all
			find . -name "*.so" -exec strip -s {} \;
			DEPENDS="libgnomeui libsoup"
			;;
		*-dev)
			mkdir -p $fs/usr/lib

			cp -a $install/usr/include $fs/usr 

			cp -a $install/usr/lib/pkgconfig $fs/usr/lib
			cp -a $install/usr/lib/*.*a $fs/usr/lib
			cp -a $install/usr/lib/evolution-data-server-1.2 $fs/usr/lib

			# Clean unwated files
			cd $fs/usr/lib  ; find . -name "*.so*" -exec rm -f {} \;
			;;
	esac
}

