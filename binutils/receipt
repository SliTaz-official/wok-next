# SliTaz package receipt v2.

PACKAGE="binutils"
VERSION="2.27"
CATEGORY="development"
SHORT_DESC="GNU assembler, linker and binary utilities"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2 LGPL2 GPL3 LGPL3"
WEB_SITE="http://www.gnu.org/software/binutils/"
TAGS="assembler linker"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="$GNU_MIRROR/$PACKAGE/$TARBALL"

BUILD_DEPENDS="glibc-dev zlib-dev texinfo bison flex gettext-tools"
BUILD_DEPENDS_arm=""
SPLIT="libbfd"

# Rules to configure and make the package.
compile_rules()
{
	case "$ARCH" in
		i?86) ARCH_ARGS="--disable-werror" ;;
	esac

	mkdir build; cd build

	$src/configure \
		--enable-shared \
		--disable-initfini-array \
		--with-bugurl="http://bugs.slitaz.org/" \
		--enable-gold \
		--enable-plugins \
		$CONFIGURE_ARGS $ARCH_ARGS &&
	make tooldir=/usr &&
	make tooldir=/usr install

	# Create prefixed version of the tools.
	cd $install/usr/bin
	for i in $(ls); do
		mv $i $TOOLPREFIX$i
		[ $i == 'strings' ] && continue # skip: Busybox intercept
		ln -s $TOOLPREFIX$i $i
	done

	# Remove prefix from manpages name
	for i in $(find $install/usr/share/man/man1 -type f); do
		mv $i ${i/$TOOLPREFIX/}
	done

#	# Install libiberty (-liberty flag): dependency described in *.la files
#	install -o root -g root -m 644 $src/include/libiberty.h $install/usr/include
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		binutils)
			copy @std @dev
			DEPENDS="glibc zlib flex libbfd"
			;;
		libbfd)
			copy libbfd*.so
			CAT="system-tools|Binary File Descriptor library"
			DEPENDS="zlib"
			;;
	esac
}
