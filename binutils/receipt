# SliTaz package receipt v2.

PACKAGE="binutils"
VERSION="2.29"
CATEGORY="development"
SHORT_DESC="GNU assembler, linker and binary utilities"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2 LGPL2 GPL3 LGPL3"
WEB_SITE="http://www.gnu.org/software/binutils/"
LFS="http://www.linuxfromscratch.org/lfs/view/stable/chapter06/binutils.html"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="$GNU_MIRROR/$PACKAGE/$TARBALL"

BUILD_DEPENDS_arm=" "
BUILD_DEPENDS="glibc-dev zlib-dev texinfo bison flex gettext-tools"
SPLIT="libbfd binutils"

compile_rules() {
	mkdir build
	cd    build

	$src/configure \
		--enable-gold \
		--enable-ld=default \
		--enable-plugins \
		--enable-shared \
		--disable-werror \
		--with-system-zlib \
		$CONFIGURE_ARGS &&
	make tooldir=/usr &&
	make tooldir=/usr install || return 1

	# Create prefixed version of the tools.
	cd $install/usr/bin
	for i in $(ls); do
		mv $i $TOOLPREFIX$i
		[ $i == 'strings' ] && continue # skip: Busybox intercept
		ln -s $TOOLPREFIX$i $i
	done

#	# Install libiberty (-liberty flag): dependency described in *.la files
#	install -o root -g root -m 644 $src/include/libiberty.h $install/usr/include
}

genpkg_rules() {
	case $PACKAGE in
		libbfd)
			copy libbfd*.so
			CAT="system-tools|Binary File Descriptor library"
			DEPENDS="zlib"
			;;
		binutils)
			copy @std @dev @rm
			DEPENDS="libbfd zlib   flex glibc"
			TAGS="LFS assembler linker"
			;;
	esac
}
