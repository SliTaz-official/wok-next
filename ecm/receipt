# SliTaz package receipt v2.

PACKAGE="ecm"
VERSION="1.03"
CATEGORY="misc"
SHORT_DESC="Converts CD image files into a lossless format optimized for \
compression tools"
MAINTAINER="slaxemulator@gmail.com"
LICENSE="GPL3"
WEB_SITE="http://www.neillcorlett.com/ecm/"

TARBALL="cmdpack-$VERSION-src.tar.gz"
WGET_URL="http://www.neillcorlett.com/downloads/$TARBALL"

SPLIT="ecm-extras"

compile_rules() {
	cd $src/src
	sed -i 's/uint8_t saved_address.4./& = {0,0,0,0}/' cdpatch.c
	mkdir -p $DESTDIR/usr/bin
	for i in *.c; do
		echo "Compile $i..."
		./mkgcc ${i%.c} || return 1
		cp -a ${i%.c} $DESTDIR/usr/bin
	done
}

genpkg_rules() {
	case $PACKAGE in
		ecm)
			mkdir -p $fs/usr/bin
			cp -a $install/usr/bin/ecm $fs/usr/bin
			ln -sf ecm $fs/usr/bin/unecm
			;;
		ecm-extras)
			mkdir -p $fs/usr
			cp -a $install/usr/bin $fs/usr
			[ -f $fs/usr/bin/ecm ] && rm -f $fs/usr/bin/ecm
			CAT="misc|extra tools"
			;;
	esac
}

