# SliTaz package receipt v2.

PACKAGE="gettext"
VERSION="0.19.8.1"
CATEGORY="development"
SHORT_DESC="Utilities for the GNU Translation Project"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL3"
WEB_SITE="https://www.gnu.org/software/gettext/"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNU_MIRROR/$PACKAGE/$TARBALL"

BUILD_DEPENDS="libcroco-dev libxml2-dev glib-dev acl-dev"
BUILD_DEPENDS_arm="attr-dev ncurses-dev libxml2-tools libxml2-dev"
SPLIT="gettext-base gettext-tools gettext"

# Handle cross compilation. Glibc-locale are installed in cross chroot.
case "$ARCH" in
	arm) ARCH_ARGS="--disable-acl" ;;
esac

# Rules to configure and make the package.
compile_rules()
{
	./configure $CONFIGURE_ARGS $ARCH_ARGS &&
	make && make install

	# stripped gettext.sh
	rm $install/usr/bin/gettext.sh
	install -m755 $stuff/gettext.sh $install/usr/bin
}

# Just to be sure when cross compiling, gettext is part of base system.
testsuite()
{
	readelf -h $install/usr/bin/gettext
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		gettext-base)
			copy gettext gettext.sh envsubst ngettext
			CAT="base-system|base tools"
			DEPENDS="glibc-base"
			;;
		gettext-tools)
			copy msgcat msgfmt msgmerge xgettext \
			libgettextlib*.so* libgettextsrc*.so*
			CAT="libs|tools"
			DEPENDS="acl attr glib libcroco libgomp liblzma libxml2 pcre zlib"
			;;
		gettext)
			copy @std @dev @rm
			# Runtime depends, then dev-depends
			DEPENDS="gettext-base gettext-tools libcroco liblzma libxml2 \
			acl-dev attr-dev libcroco-dev libxml2-dev glib-dev pcre-dev m4"
			;;
	esac
}
