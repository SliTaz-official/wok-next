# SliTaz package receipt v2.

PACKAGE="gettext"
VERSION="0.19.8.1"
CATEGORY="development"
SHORT_DESC="Utilities for the GNU Translation Project"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL3"
WEB_SITE="https://www.gnu.org/software/gettext/"
LFS="http://www.linuxfromscratch.org/lfs/view/stable/chapter06/gettext.html"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNU_MIRROR/$PACKAGE/$TARBALL"

BUILD_DEPENDS_arm="attr-dev ncurses-dev libxml2-tools libxml2-dev"
BUILD_DEPENDS="libcroco-dev libxml2-dev glib-dev acl-dev"
SPLIT="gettext-base gettext-tools gettext"

compile_rules() {
	case "$ARCH" in
		arm) ARCH_ARGS="--disable-acl";;
	esac

	fix ld
	./configure $CONFIGURE_ARGS $ARCH_ARGS && make && make install || return 1

	chmod 0755 $install/usr/lib/preloadable_libintl.so

	# stripped gettext.sh
	rm $install/usr/bin/gettext.sh
	install -m755 $stuff/gettext.sh $install/usr/bin
}

# Just to be sure when cross compiling, gettext is part of base system.
testsuite() {
	readelf -h $install/usr/bin/gettext
}

genpkg_rules() {
	case $PACKAGE in
		gettext-base)
			copy gettext gettext.sh envsubst ngettext
			CAT="base-system|base tools"
			DEPENDS="glibc-base"
			;;
		gettext-tools)
			copy msgcat msgfmt msgmerge xgettext \
			libgettextlib*.so* libgettextsrc*.so*
			CAT="libs|tools"
			DEPENDS="acl attr glib libcroco libgomp liblzma libxml2 ncurses \
			pcre zlib"
			;;
		gettext)
			copy @std @dev @rm
			rm -rf $fs/usr/share/doc/ # @dev files here
			# Runtime depends, then dev-depends
			DEPENDS="gettext-base gettext-tools libcroco liblzma libxml2 \
			acl-dev attr-dev libcroco-dev libxml2-dev glib-dev pcre-dev m4"
			TAGS="LFS"
			;;
	esac
}
