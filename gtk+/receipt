# SliTaz package receipt v2.

PACKAGE="gtk+"
VERSION="2.24.31"
CATEGORY="x-window"
SHORT_DESC="The GIMP Toolkit"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://www.gtk.org/"
LFS="http://www.linuxfromscratch.org/blfs/view/stable/x/gtk2.html"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNOME_MIRROR/$PACKAGE/${VERSION:0:4}/$TARBALL"

BUILD_DEPENDS_arm="atk-dev pango-dev gdk-pixbuf-dev dbus-dev dbus-glib-dev \
xorg-inputproto xorg-libxcb-dev fontconfig-dev freetype-dev xorg-pixman-dev libxml2-dev \
libpng-dev libffi-dev xorg-xextproto harfbuzz-dev faenza-icon-theme optipng \
xorg-libX11-dev xorg-libXext-dev xorg-libXrender-dev automake"
BUILD_DEPENDS="paper-icon-theme rsvg-convert optipng-static pngquant-static \
symlinks \
glib-dev atk-dev pango-dev cairo-dev gdk-pixbuf-dev cups-dev \
gobject-introspection-dev gtk-doc automake gettext xorg-libXinerama-dev"
BUILD_DEPENDS="glib-dev atk-dev pango-dev cairo-dev gdk-pixbuf-dev cups-dev \
gobject-introspection-dev gtk-doc gettext xorg-libXinerama-dev"
SPLIT="gtk+-demo gtk+ gtk+-dev"

compile_rules() {
	case "$ARCH" in
		arm*)
			BUILD_DEPENDS=$BUILD_DEPENDS_arm
			ARCH_ARGS="--enable-introspection=no --disable-glibtest --disable-cups \
			--disable-papi --with-gdktarget=x11 --with-xinput gio_can_sniff=yes"
			export LDFLAGS="$LDFLAGS -L/cross/$ARCH/sysroot/usr/lib"
			export CPPFLAGS="$CPPFLAGS -I/cross/$ARCH/sysroot/usr/include"
			export LIBTOOL=${HOST_SYSTEM}-libtool
			;;
	esac

#	. $stuff/replace-icons-paper; cd $src

#	find $src -type f -name 'Makefile.in' -exec sed -i 's|1.15|1.15.1|' '{}' \;
# or
#	autoreconf -fi && # fix 'version mismatch' between 1.15 and 1.15.1
	./configure \
		--enable-debug=no \
		$CONFIGURE_ARGS $ARCH_ARGS &&
	make $MAKEFLAGS $LIBTOOL &&
	make install || return 1

	ln -s /usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache \
		$install/etc/gtk-2.0/gdk-pixbuf.loaders

	mkdir -p $install/usr/share/applications
	cp $stuff/*.desktop $install/usr/share/applications
}

genpkg_rules() {
	case $PACKAGE in
		gtk+-demo)
			copy gtk-demo demo/ *.desktop
			CAT="development|example code and demo"
			DEPENDS="atk bzlib cairo fontconfig freetype gdk-pixbuf glib gtk+ \
			libffi libharfbuzz liblzma libpng16 libxml2 pango pcre \
			util-linux-blkid util-linux-mount util-linux-uuid xorg-libX11 \
			xorg-libXau xorg-libXdmcp xorg-libXext xorg-libXinerama \
			xorg-libXrender xorg-libxcb xorg-pixman zlib"
			;;
		gtk+)
			COOKOPTS="!menus"
			copy @std @rm
			DEPENDS="atk bzlib cairo fontconfig freetype gdk-pixbuf glib \
			libcups libffi libgnutls libharfbuzz liblzma libpng16 libxml2 \
			pango pcre util-linux-blkid util-linux-mount util-linux-uuid \
			xorg-libX11 xorg-libXau xorg-libXdmcp xorg-libXext \
			xorg-libXinerama xorg-libXrender xorg-libxcb xorg-pixman zlib"
			CONFIG_FILES="/etc/gtk-2.0/im-multipress.conf"
			SUGGESTED="cups gnutls libgcrypt libgpg-error"
			;;
		gtk+-dev)
			copy @dev
			DEPENDS="gtk+ \
			atk-dev bzip2-dev cairo-dev cups-dev fontconfig-dev \
			freetype-dev gdk-pixbuf-dev glib-dev glibc-dev gnutls-dev \
			harfbuzz-dev libffi-dev liblzma-dev libpng16-dev libxml2-dev \
			pango-dev pcre-dev util-linux-blkid-dev util-linux-mount-dev \
			util-linux-uuid-dev xorg-libX11-dev xorg-libXau-dev \
			xorg-libXdmcp-dev xorg-libXext-dev xorg-libXinerama-dev \
			xorg-libXrender-dev xorg-libxcb-dev xorg-pixman-dev xz-dev zlib-dev"
			;;
	esac
}

post_install_gtk_() {
	chroot "$1/" /usr/bin/gtk-query-immodules-2.0 --update-cache
}
