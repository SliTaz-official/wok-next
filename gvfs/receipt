# SliTaz package receipt v2.

PACKAGE="gvfs"
VERSION="1.30.3"
CATEGORY="system-tools"
SHORT_DESC="Userspace virtual filesystem"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://wiki.gnome.org/Projects/gvfs"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNOME_MIRROR/gvfs/${VERSION%.*}/$TARBALL"

BUILD_DEPENDS="libxslt glib-dev gtk-doc dbus-dev gcr-dev gettext polkit-dev \
libcap-dev libgphoto2-dev libarchive-dev libsoup-dev libcdio-paranoia-dev \
libmtp-dev fuse-dev udisks2-dev gtk+3-dev libbluray-dev libgudev-dev \
libsecret-dev libxml2-dev openssh samba-dev dbus-glib-dev libnfs-dev"
SPLIT="gvfs-admin gvfs-afp gvfs-archive gvfs-cdda gvfs-fuse gvfs-gphoto2 \
gvfs-gtk gvfs-http gvfs-libmtp gvfs-nfs gvfs-smb gvfs-udisks2 gvfs gvfs-dev"
COOKOPTS="skip-log-errors"

# Rules to configure and make the package.
compile_rules()
{
	# http://www.linuxfromscratch.org/blfs/view/stable/gnome/gvfs.html

	./configure \
		--sysconfdir=/etc \
		--enable-gtk-doc \
		--disable-libsystemd-login \
		--with-systemduserunitdir=no \
		--disable-bash-completion \
		$CONFIGURE_ARGS && \
		make && make install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	# gvfs-obexftp is called obsolete and deleted by gvfs authors.
	case $PACKAGE in
		gvfs-admin)
			copy gvfsd-admin admin.mount
			CAT="system-tools|admin backend"
			DEPENDS="gvfs libcap polkit"
			;;
		gvfs-afp)
			copy \
			gvfsd-afp        afp.mount \
			gvfsd-afp-browse afp-browse.mount
			CAT="system-tools|Apple Filing Protocol support - afp:///"
			DEPENDS="gvfs"
			;;
		gvfs-archive)
			copy gvfsd-archive archive.mount
			CAT="system-tools|archive support - archive:///"
			DEPENDS="gvfs acl attr bzlib libarchive openssl liblzma libxml2 \
			lz4-lib lzo nettle"
			;;
		gvfs-cdda)
			copy gvfsd-cdda cdda.mount
			CAT="system-tools|CDDA support"
			DEPENDS="gvfs libcdio libcdio-paranoia libgudev"
			;;
		gvfs-fuse)
			copy gvfsd-fuse
			CAT="system-tools|FUSE support"
			DEPENDS="gvfs fuse"
			;;
		gvfs-gphoto2)
			copy \
			gvfsd-gphoto2 gphoto2.mount \
			gvfs-gphoto2-volume-monitor *.GPhoto2VolumeMonitor.service \
			gphoto2.monitor
			CAT="system-tools|Gphoto2 support"
			DEPENDS="gvfs libexif libgphoto2 libgudev libltdl"
			;;
		gvfs-gtk)
			copy gvfsd-recent recent.mount
			CAT="system-tools|recent files support (GTK+3) - recent:///"
			DEPENDS="gvfs atk bzlib cairo fontconfig freetype gdk-pixbuf gtk+3 \
			libharfbuzz liblzma libpng16 libxml2 pango xorg-libX11 xorg-libXau \
			xorg-libXdmcp xorg-libXext xorg-libXrender xorg-libxcb xorg-pixman"
			;;
		gvfs-http)
			copy \
			gvfsd-dav  dav.mount \
			gvfsd-http http.mount
			CAT="system-tools|HTTP/WebDAV support"
			DEPENDS="gvfs liblzma libsoup libsqlite3 libxml2"
			;;
		gvfs-libmtp)
			copy \
			gvfsd-mtp mtp.mount \
			gvfs-mtp-volume-monitor *.MTPVolumeMonitor.service \
			mtp.monitor
			CAT="system-tools|MTP support"
			DEPENDS="gvfs libgudev libmtp libusb"
			;;
		gvfs-nfs)
			copy gvfsd-nfs nfs.mount
			CAT="system-tools|NFS support - nfs:///"
			DEPENDS="gvfs libnfs"
			;;
		gvfs-smb)
			copy \
			gvfsd-smb        smb.mount \
			gvfsd-smb-browse smb-browse.mount \
			gvfs-smb.convert *.smb.gschema.xml
			CAT="system-tools|Samba support - smb:///"
			DEPENDS="gvfs samba"
			;;
		gvfs-udisks2)
			copy gvfs-udisks2-volume-monitor *.UDisks2VolumeMonitor.service \
			udisks2.monitor
			CAT="system-tools|Udisks2 volume monitor"
			DEPENDS="gvfs bzlib fontconfig freetype libbluray libgudev \
			libharfbuzz liblzma libpng16 libxml2 udisks2"
			;;
		gvfs)
			copy @std @rm
			DEPENDS="eudev gcr-base glib libffi libgcrypt libgpg-error \
			libsecret p11-kit pcre util-linux-blkid util-linux-mount \
			util-linux-uuid zlib   dbus"
			SUGGESTED="gvfs-afp gvfs-archive gvfs-cdda gvfs-fuse gvfs-gphoto2 \
			gvfs-http gvfs-libmtp gvfs-obexftp gvfs-smb gvfs-udisks2"
			;;
		*-dev)
			copy @dev
			DEPENDS="${SPLIT/gvfs-dev/}
			gcr-dev glib-dev libffi-dev libgcrypt-dev libgpg-error-dev \
			libsecret-dev p11-kit-dev pcre-dev util-linux-blkid-dev \
			util-linux-mount-dev util-linux-uuid-dev zlib-dev"
			;;
	esac
}

post_remove_gvfs() {
	chroot "$1/" /usr/bin/glib-compile-schemas /usr/share/glib-2.0/schemas
}
