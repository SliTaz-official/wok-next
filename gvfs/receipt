# SliTaz package receipt v2.

PACKAGE="gvfs"
VERSION="1.28.3"
CATEGORY="system-tools"
SHORT_DESC="Userspace virtual filesystem"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2"
WEB_SITE="http://www.gnome.org/"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNOME_MIRROR/$PACKAGE/${VERSION%.*}/$TARBALL"

BUILD_DEPENDS="libxslt libgio-dev gtk-doc glib-dev dbus-dev gcr-dev intltool \
libgphoto2-dev libarchive-dev libsoup-dev libcdio-dev libmtp-dev fuse-dev \
udisks2-dev gtk+3-dev"
#BUILD_DEPENDS+"samba-dev smbclient expat-dev dbus-glib-dev bluez-dev"
SPLIT="gvfs-afp gvfs-archive gvfs-cdda gvfs-fuse gvfs-gphoto2 gvfs-gtk \
gvfs-http gvfs-libmtp gvfs-udisks2 gvfs-dev"
# Currently disabled: gvfs-obexftp gvfs-smb

# Rules to configure and make the package.
compile_rules()
{
	./configure \
		--sysconfdir=/etc \
		--enable-gtk-doc \
		--disable-libsystemd-login \
		--with-systemduserunitdir=no \
		$CONFIGURE_ARGS && \
		make && make install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		gvfs)
			copy bin/ *.so \
			gvfsd           *.Daemon.service \
			gvfsd-burn      burn.mount \
			gvfsd-computer  computer.mount \
			gvfsd-ftp       ftp.mount \
			gvfsd-localtest localtest.mount \
			gvfsd-metadata  *.Metadata.service \
			gvfsd-network   network.mount \
			gvfsd-sftp      sftp.mount \
			gvfsd-trash     trash.mount \
			org.gnome.system.gvfs.enums.xml
			DEPENDS="dbus glib glibc-base libffi libgio pcre udev zlib"
			SUGGESTED="gvfs-afp gvfs-archive gvfs-cdda gvfs-fuse gvfs-gphoto2 \
			gvfs-http gvfs-libmtp gvfs-obexftp gvfs-smb gvfs-udisks2"
			;;
		gvfs-afp)
			copy \
			gvfsd-afp        afp.mount \
			gvfsd-afp-browse afp-browse.mount
			CAT="system-tools|Apple Filing Protocol support - afp:///"
			DEPENDS="gcr-base glib gvfs libffi libgcrypt libgio libgpg-error \
			p11-kit pcre zlib"
			;;
		gvfs-archive)
			copy gvfsd-archive archive.mount
			CAT="system-tools|archive support - archive:///"
			DEPENDS="acl attr bzlib gcr-base glib gvfs libarchive libcrypto \
			libffi libgcrypt libgio libgpg-error liblzma libxml2 lz4-lib lzo \
			nettle p11-kit pcre zlib"
			;;
		gvfs-cdda)
			copy gvfsd-cdda cdda.mount
			CAT="system-tools|CDDA support"
			DEPENDS="eudev gcr-base glib gvfs libcdio libffi libgcrypt libgio \
			libgpg-error libgudev p11-kit pcre zlib"
			;;
		gvfs-fuse)
			copy gvfsd-fuse
			CAT="system-tools|FUSE support"
			DEPENDS="fuse glib gvfs libffi libgio pcre zlib"
			;;
		gvfs-gphoto2)
			copy \
			gvfsd-gphoto2 gphoto2.mount \
			gvfs-gphoto2-volume-monitor *.GPhoto2VolumeMonitor.service \
			gphoto2.monitor
			CAT="system-tools|Gphoto2 support"
			DEPENDS="eudev gcr-base glib gvfs libexif libffi libgcrypt libgio \
			libgpg-error libgphoto2 libgudev libltdl p11-kit pcre zlib"
			;;
		gvfs-gtk)
			copy gvfsd-recent recent.mount
			CAT="system-tools|recent files support (GTK+3) - recent:///"
			DEPENDS="atk bzlib cairo fontconfig freetype gcr-base gdk-pixbuf \
			glib gtk+3 gvfs harfbuzz libffi libgcrypt libgio libgpg-error \
			liblzma libpng libxcb libxml2 p11-kit pango pcre pixman \
			xorg-libX11 xorg-libXau xorg-libXdmcp xorg-libXext xorg-libXrender \
			zlib"
			;;
		gvfs-http)
			copy \
			gvfsd-dav  dav.mount \
			gvfsd-http http.mount
			CAT="system-tools|HTTP/WebDAV support"
			DEPENDS="gcr-base glib gvfs libffi libgcrypt libgio libgpg-error \
			liblzma libsoup libsqlite libxml2 p11-kit pcre zlib"
			;;
		gvfs-libmtp)
			copy \
			gvfsd-mtp mtp.mount \
			gvfs-mtp-volume-monitor *.MTPVolumeMonitor.service \
			mtp.monitor
			CAT="system-tools|MTP support"
			DEPENDS="eudev gcr-base glib gvfs libffi libgcrypt libgio \
			libgpg-error libgudev libmtp libusb p11-kit pcre zlib"
			;;
		gvfs-obexftp)
			copy gvfsd-obexftp obexftp.mount
			CAT="system-tools|ObexFTP support"
			DEPENDS="gvfs bluez dbus dbus-glib expat glib glibc-base libffi \
			libgio pcre zlib"
			;;
		gvfs-smb)
			copy \
			gvfsd-smb        smb.mount \
			gvfsd-smb-browse smb-browse.mount \
			gvfs-smb.convert *.smb.gschema.xml
			CAT="system-tools|Samba support - smb:///"
			DEPENDS="gvfs glib glibc-base libcomerr libcomerr3 libcrypto \
			libffi libgio libkrb5 libldap libssl pcre samba-common smbclient \
			talloc zlib"
			;;
		gvfs-udisks2)
			copy gvfs-udisks2-volume-monitor *.UDisks2VolumeMonitor.service \
			udisks2.monitor
			CAT="system-tools|Udisks2 volume monitor"
			DEPENDS="eudev glib gvfs libffi libgio libgudev pcre udisks2 zlib"
			;;
		*-dev) copy @dev;;
	esac
}

post_remove_gvfs() {
	chroot "$1/" /usr/bin/glib-compile-schemas /usr/share/glib-2.0/schemas
}
