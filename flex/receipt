# SliTaz package receipt v2.

PACKAGE="flex"
VERSION="2.6.4"
CATEGORY="development"
SHORT_DESC="Flex is a fast lexical analyser generator"
MAINTAINER="pankso@slitaz.org"
LICENSE="BSD"
WEB_SITE="https://github.com/westes/flex"
LFS="http://www.linuxfromscratch.org/lfs/view/stable/chapter06/flex.html"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="$WEB_SITE/releases/download/v$VERSION/$TARBALL"
TARBALL_MD5="2882e3179748cc9f9c23ec593d6adc8d"

BUILD_DEPENDS="bison gettext help2man indent"

SPLIT="libflex flex"

compile_rules() {
	case "$ARCH" in
		arm*)
			export ac_cv_func_malloc_0_nonnull=yes
			export ac_cv_func_realloc_0_nonnull=yes
	esac

	# Fix a problem introduced with glibc-2.26
	sed -i "/math.h/a #include <malloc.h>" src/flexdef.h

	./configure $CONFIGURE_ARGS &&
	fix libtool &&
	make &&
	make install || return 1

	ln -s flex $install/usr/bin/lex
}

genpkg_rules() {
	case $PACKAGE in
		libflex)
			copy *.so*
			;;
		*)
			copy @std @dev @rm
			DEPENDS="libflex   bison"
			TAGS="LFS"
			;;
	esac
}
