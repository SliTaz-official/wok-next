# SliTaz package receipt v2.

PACKAGE="netsurf"
COMMIT="d3493b138f38c9e26da24fcffb3ef8b813e3ca4e"
VERSION="3.6-170919"
CATEGORY="network"
SHORT_DESC="Lightweight and fast web browser"
MAINTAINER="al.bobylev@gmail.com"
LICENSE="GPL2"
WEB_SITE="http://www.netsurf-browser.org/"

TARBALL="$PACKAGE-${COMMIT:-$VERSION}.tar.bz2"
BASE_URL="http://source.netsurf-browser.org/$PACKAGE.git/snapshot"
if [ -n "$COMMIT" ]; then
	WGET_URL="$BASE_URL/$PACKAGE-$COMMIT.tar.bz2"
else
	WGET_URL="$BASE_URL/release/$VERSION.tar.bz2"
fi

BUILD_DEPENDS="libjpeg-turbo-dev libharu-dev duktape-dev libcss-dev libdom-dev \
libnsutils-dev libutf8proc-dev curl-dev openssl-dev libpng16-dev libnsbmp-dev \
libnsgif-dev libsvgtiny-dev libnspsl-dev libnslog-dev gstreamer0-dev gtk+-dev \
check-dev perl-html-parser nsgenbind" # librsvg-dev

compile_rules() {
	[ -z "$COMMIT" ] && cd $VERSION

	# Enable NetSurf's use of gstreamer for displaying videos
	echo 'override NETSURF_USE_VIDEO := YES' > Makefile.config
	# Enable NetSurf's use of libharu for PDF export and GTK printing support.
#	echo 'override NETSURF_USE_HARU_PDF := YES' >> Makefile.config
	# Template used for constructing the User Agent: string.
	# 1,2: major & minor version numbers; 3 `uname -s`; 4 `uname -m`
	echo 'override NETSURF_UA_FORMAT_STRING := "NetSurf/%d.%d (SliTaz GNU/%s %s)"' >> Makefile.config
	# Default home page, if one is not defined by the user.
	echo 'override NETSURF_HOMEPAGE := "file:///usr/share/webhome/index.html"' >> Makefile.config


	# fix installing
	sed -i '/install \$(EXETARGET)/ s|^|#|' frontends/gtk/Makefile

	make \
		PREFIX=/usr \
		LIBDIR=lib \
		INCLUDEDIR=include \
		TARGET=gtk \
		NETSURF_GTK_MAJOR=2 \
		install || return 1
	# FIXME: it is job for `make`
	cp -af nsgtk $install/usr/bin/netsurf-gtk

	# desktop shortcut
	mkdir -p $install/usr/share/applications
	sed 's|netsurf.png|netsurf|' \
		< frontends/gtk/res/netsurf-gtk.desktop \
		> $install/usr/share/applications/netsurf-gtk.desktop
	# desktop icons
	mkdir -p $install/usr/share/icons
	cp -r $stuff/hicolor $install/usr/share/icons

	chown -R root:root $install
}

genpkg_rules() {
	copy @std
	# Remove files to save some space
	rm -rf $fs/usr/share/netsurf/*.xpm
	DEPENDS="atk cairo expat fontconfig freetype gdk-pixbuf glib gstreamer0 \
	gtk+ openssl libcss libcurl libdom libhubbub libjpeg-turbo libnsbmp \
	libnsgif libnslog libnspsl libnsutils libparserutils libpng16 \
	libsvgtiny libutf8proc libwapcaplet libxml2 pango zlib"
	TAGS="web-browser"
}
