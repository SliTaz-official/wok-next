# SliTaz package receipt.

PACKAGE="ncurses"
VERSION="6.0"
CATEGORY="base-system"
SHORT_DESC="Library of functions to manage display on terminals."
MAINTAINER="pankso@slitaz.org"
LICENSE="MIT"
WEB_SITE="https://www.gnu.org/software/ncurses/"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="http://ftp.gnu.org/gnu/ncurses/$TARBALL"
HOST_ARCH="i486 arm"

DEPENDS=""
BUILD_DEPENDS="flex"
SPLIT="ncurses-libform ncurses-libmenu ncurses-libpanel ncurses-extra \
ncurses-dev"

case "$ARCH" in
	arm) BUILD_DEPENDS="" ;;
esac

# Rules to configure and make the package.
compile_rules()
{
	sed -i '/LIBTOOL_INSTALL/d' c++/Makefile.in

	./configure \
		--with-shared \
		--without-debug \
		--without-ada \
		--enable-widec \
		--with-build-cc="gcc -D_GNU_SOURCE" \
		--enable-pc-files \
		--with-pkg-config-libdir=/usr/lib/pkgconfig \
		$CONFIGURE_ARGS &&
	make && make install

	mkdir -p $install/lib
	mv $install/usr/lib/libncursesw.so.6* $install/lib
	ln -sf ../../lib/$(readlink $install/usr/lib/libncursesw.so) \
		$install/usr/lib/libncursesw.so

	for i in ncurses form panel menu; do
		rm -f                   $install/usr/lib/lib$i.so
		echo "INPUT(-l${i}w)" > $install/usr/lib/lib$i.so
		chmod 755               $install/usr/lib/lib$i.so
		ln -sf ${i}w.pc         $install/usr/lib/pkgconfig/$i.pc
	done

	rm -f                      $install/usr/lib/libcursesw.so
	echo "INPUT(-lncursesw)" > $install/usr/lib/libcursesw.so
	chmod 755                  $install/usr/lib/libcursesw.so
	ln -sf libncurses.so       $install/usr/lib/libcurses.so

	mkdir -p    $install/usr/share/doc/ncurses-$VERSION
	cp -a doc/* $install/usr/share/doc/ncurses-$VERSION
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	# binaries and library
	cook_copy_files clear tset reset libncursesw.so*

	# tabset
	cook_copy_folders tabset

	# terminfo
	cook_copy_files ansi linux rxvt vt100 vt102* xterm xterm-256color \
		xterm-color xterm-new xterm-vt220
}

post_remove()
{
	# restore Busybox applet links
	ln -s /bin/busybox $root/usr/bin/clear
	ln -s /bin/busybox $root/usr/bin/reset
}
