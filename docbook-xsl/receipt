# SliTaz package receipt v2.

PACKAGE="docbook-xsl"
VERSION="1.79.2"
CATEGORY="development"
SHORT_DESC="DocBook XSL stylesheets"
MAINTAINER="paul@slitaz.org"
LICENSE="MIT"
WEB_SITE="https://github.com/docbook/xslt10-stylesheets"
LFS="http://www.linuxfromscratch.org/blfs/view/svn/pst/docbook-xsl.html"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="https://github.com/docbook/xslt10-stylesheets/releases/download/release%2F$VERSION/$TARBALL"

compile_rules() {
	mkdir -p $install/usr/share/xml/docbook/stylesheet/docbook-xsl/

	cp -R \
		VERSION assembly common eclipse epub epub3 extensions fo highlighting \
		html htmlhelp images javahelp lib manpages params profiling roundtrip \
		slides template tests tools webhelp website xhtml xhtml-1_1 xhtml5 \
		$install/usr/share/xml/docbook/stylesheet/docbook-xsl/ &&

	ln -s VERSION $install/usr/share/xml/docbook/stylesheet/docbook-xsl/VERSION.xsl &&

	cook_pick_docs README RELEASE-NOTES* NEWS*
}

genpkg_rules() {
	copy @std
	DEPENDS="docbook-xml libxml2-tools libxslt"
}

post_install() {
	if [ -n "$1" ]; then
		mv -f "$1/etc/resolv.conf" "$1/etc/recolv.conf.$$" 2>/dev/null
		cp /etc/resolv.conf "$1/etc/resolv.conf"
	fi

	U="http://docbook.sourceforge.net/release/xsl"
	F="/usr/share/xml/docbook/stylesheet/docbook-xsl"
	C="/etc/xml/catalog"

	# Create a /etc/xml/catalog file
	mkdir -p "$1/etc/xml"
	if [ ! -f "$1/etc/xml/catalog" ]; then
		chroot "$1/" xmlcatalog --noout --create "$C"
	fi &&

	chroot "$1/" xmlcatalog --noout --add rewriteSystem "$U/$VERSION" "$F" $C &&
	chroot "$1/" xmlcatalog --noout --add rewriteURI    "$U/$VERSION" "$F" $C &&
	chroot "$1/" xmlcatalog --noout --add rewriteSystem "$U/current"  "$F" $C &&
	chroot "$1/" xmlcatalog --noout --add rewriteURI    "$U/current"  "$F" $C

#	# link nwalsh dir
#	ln -sf docbook-xsl "$1/usr/share/xml/docbook/stylesheet/nwalsh"

	if [ -n "$1" ]; then
		mv -f "$1/etc/resolv.conf.$$" "$1/etc/recolv.conf" 2>/dev/null
	fi

	:
}
