# SliTaz package receipt.

PACKAGE="libcap"
VERSION="2.25"
CATEGORY="system-tools"
SHORT_DESC="Support for getting/setting POSIX.1e capabilities."
MAINTAINER="pankso@slitaz.org"
LICENSE="BSD"
WEB_SITE="https://sites.google.com/site/fullycapable/"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="https://www.kernel.org/pub/linux/libs/security/linux-privs/libcap2/$TARBALL"

DEPENDS="attr"
BUILD_DEPENDS="gperf pam-dev attr-dev"

# Handle cross compilation.
case "$ARCH" in
	i?86) BUILD_DEPENDS="$BUILD_DEPENDS perl"  ;;
	arm*) ARCH_ARGS="CC=$HOST_SYSTEM-gcc BUILD_CC=gcc" ;;
esac

# Rules to configure and make the package.
compile_rules()
{
	sed -i '/install.*STALIBNAME/d' libcap/Makefile

	make $ARCH_ARGS &&
	make RAISE_SETFCAP=no prefix=/usr install

	chmod 755 $install/usr/lib/libcap.so
	mkdir $install/lib
	mv $install/usr/lib/libcap.so.* $install/lib
	ln -sf ../../lib/$(readlink $install/usr/lib/libcap.so) \
		$install/usr/lib/libcap.so
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cook_copy_folders sbin
	cook_copy_files *.so*
}
