# SliTaz package receipt v2.

PACKAGE="libcap"
VERSION="2.25"
CATEGORY="system-tools"
SHORT_DESC="Support for getting/setting POSIX.1e capabilities"
MAINTAINER="pankso@slitaz.org"
LICENSE="BSD"
WEB_SITE="https://sites.google.com/site/fullycapable/"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="https://www.kernel.org/pub/linux/libs/security/linux-privs/libcap2/$TARBALL"

BUILD_DEPENDS="gperf pam-dev attr-dev perl"
BUILD_DEPENDS_arm="gperf pam-dev attr-dev"
SPLIT="libcap-pam libcap-dev"

# Handle cross compilation.
case "$ARCH" in
	arm*) ARCH_ARGS="CC=$HOST_SYSTEM-gcc BUILD_CC=gcc" ;;
esac

# Rules to configure and make the package.
compile_rules()
{
	sed -i '/install.*STALIBNAME/d' libcap/Makefile

	make $ARCH_ARGS &&
	make RAISE_SETFCAP=no prefix=/usr install || return 1

	chmod 755 $install/usr/lib/libcap.so
	mkdir $install/lib
	mv $install/usr/lib/libcap.so.* $install/lib
	ln -sf ../../lib/$(readlink $install/usr/lib/libcap.so) \
		$install/usr/lib/libcap.so
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		libcap)
			copy @std
			DEPENDS="attr"
			;;
		libcap-pam)
			CAT="system-tools|PAM module"
			PROVIDE="libcap:pam"
			DEPENDS="libcap pam"
			copy pam_cap.so
			;;
		*-dev) copy @dev;;
	esac
}
