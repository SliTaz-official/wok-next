# SliTaz package receipt v2.

PACKAGE="libcap"
VERSION="2.25"
CATEGORY="system-tools"
SHORT_DESC="Support for getting/setting POSIX.1e capabilities"
MAINTAINER="pankso@slitaz.org"
LICENSE="BSD"
WEB_SITE="https://sites.google.com/site/fullycapable/"
LFS="http://www.linuxfromscratch.org/lfs/view/stable/chapter06/libcap.html"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="https://www.kernel.org/pub/linux/libs/security/linux-privs/libcap2/$TARBALL"

BUILD_DEPENDS_arm="gperf pam-dev attr-dev"
BUILD_DEPENDS="gperf pam-dev attr-dev perl"
SPLIT="libcap-pam libcap libcap-dev"

compile_rules() {
	# Handle cross compilation.
	case "$ARCH" in
		arm*) ARCH_ARGS="CC=$HOST_SYSTEM-gcc BUILD_CC=gcc" ;;
	esac

	# Prevent a static library from being installed
	sed -i '/install.*STALIBNAME/d' libcap/Makefile

	make $ARCH_ARGS &&
	make \
		RAISE_SETFCAP=no \
		lib=lib \
		prefix=/usr \
		install || return 1

	chmod 755 $install/usr/lib/libcap.so
	mkdir $install/lib
	mv $install/usr/lib/libcap.so.* $install/lib
	ln -sf ../../lib/$(readlink $install/usr/lib/libcap.so) \
		$install/usr/lib/libcap.so
}

genpkg_rules() {
	case $PACKAGE in
		libcap-pam)
			copy pam_cap.so
			CAT="system-tools|PAM module"
			PROVIDE="libcap:pam"
			DEPENDS="libcap pam"
			;;
		libcap)
			copy @std @rm
			DEPENDS="attr"
			TAGS="LFS"
			;;
		*-dev) copy @dev;;
	esac
}
