# SliTaz package receipt v2.

PACKAGE="cdrkit"
VERSION="1.1.11"
CATEGORY="utilities"
SHORT_DESC="Wodim for recording/blanking CDs/DVDs and genisoimage for ISO"
MAINTAINER="devel@slitaz.org"
LICENSE="GPL2"
WEB_SITE="http://www.cdrkit.org/"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="http://cdrkit.org/releases/$TARBALL"
EXTRA_SOURCE_FILES="cdrkit-1.1.9-efi-boot.patch"

BUILD_DEPENDS="cmake libcap-dev zlib-dev bzip2-dev attr-dev"
SPLIT="$PACKAGE-audio $PACKAGE-isoinfo readom"

compile_rules() {
	sed -i -e '/USE_MAGIC/d' -e '/(MAGICLIBS magic)/d' \
		genisoimage/CMakeLists.txt
	[ -s $SRC/cdrkit-1.1.9-efi-boot.patch ] ||
		wget -P $SRC https://github.com/NixOS/nixpkgs/raw/master/pkgs/tools/cd-dvd/cdrkit/cdrkit-1.1.9-efi-boot.patch
	patch -p1 < $SRC/cdrkit-1.1.9-efi-boot.patch

	make PREFIX=/usr &&
	make PREFIX=/usr install
}

genpkg_rules() {
	case $PACKAGE in
		cdrkit)
			DEPENDS="libcap zlib bzlib attr"
			mkdir -p $fs/usr/bin
			cp $install/usr/bin/genisoimage $fs/usr/bin
			cp $install/usr/bin/wodim $fs/usr/bin
			# Make symlinks for cdrtools compatibility
			cd $fs/usr/bin
			ln -s wodim cdrecord
			ln -s genisoimage mkisofs
			ln -s genisoimage mkhybrid
			;;
		cdrkit-audio)
			CAT="multimedia|Icedax, cdda2ogg and other tools for extracting audio files."
			mkdir -p $fs/usr/bin
			cp -a $install/usr/bin/cdda* $fs/usr/bin
			cp $install/usr/bin/icedax $fs/usr/bin
			cp $install/usr/bin/pitchplay $fs/usr/bin
			# Make symlinks for cdrtools compatibility
			cd $fs/usr/bin
			ln -s icedax cdda2wav 
			;;
		cdrkit-isoinfo)
			CAT="multimedia|Isoinfo Utility programs for iso9660 images"
			mkdir -p $fs/usr/bin
			cp -a $install/usr/bin/isoinfo $fs/usr/bin	
			;;
		readom)
			CAT="utilities|readom as readcd for use with graveman"
			mkdir -p $fs/usr/bin
			cp $install/usr/bin/readom $fs/usr/bin

			# Make symlinks for cdrtools compatibility
			cd $fs/usr/bin
			ln -s readom readcd
			;;
	esac
}
