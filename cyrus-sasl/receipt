# SliTaz package receipt v2.

PACKAGE="cyrus-sasl"
VERSION="2.1.26"
CATEGORY="network"
SHORT_DESC="SASL authentication server"
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="BSD"
WEB_SITE="http://cyrusimap.web.cmu.edu/"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="ftp://ftp.cyrusimap.org/cyrus-sasl/$TARBALL"

BUILD_DEPENDS="automake libtool openldap-dev db-dev openssl-dev krb5-dev"
SPLIT="libsasl libsasl-modules cyrus-sasl cyrus-sasl-dev"
SIBLINGS="cyrus-sasl-pam libsasl-without-ldap"

# Rules to configure and make the package.
compile_rules()
{
	autoreconf -fi &&

	./configure \
		--sysconfdir=/etc \
		--enable-auth-sasldb \
		--with-dbpath=/var/lib/sasl/sasldb2 \
		--with-saslauthd=/var/run/saslauthd \
		--without-pam \
		--with-devrandom=/dev/urandom \
		--with-ldap \
		--with-openssl \
		$CONFIGURE_ARGS &&
	mkdir -p $src/saslauthd/cmulocal &&
	make && make install &&

	docdir="$install/usr/share/doc/cyrus-sasl-$VERSION"
	mkdir -p $docdir &&
	cd $src/doc &&
	cp *.html *.txt ONEWS TODO ../saslauthd/LDAP_SASLAUTHD $docdir &&

	cp -a $stuff/etc $install &&
	chown -R root:root $install/etc
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		libsasl)
			copy libsasl2*.so*
			CAT="system-tools|library"
			DEPENDS=" "
			;;
		libsasl-modules)
			copy sasl2/*.so*
			CAT="system-tools|library modules"
			PROVIDE="libsasl-without-ldap"
			DEPENDS="libcomerr3 libcrypto libdb libkrb5"
			;;
		cyrus-sasl)
			copy @std
			remove_already_packed
			DEPENDS="libcomerr3 libcrypto libdb libkrb5 libldap libsasl \
			libsasl-modules libssl"
			;;
		*-dev)
			copy @dev
			DEPENDS="db-dev krb5-dev libcrypto-dev"
			;;
	esac
}

post_install_cyrus_sasl() {
	[ -d "$1/var/lib/sasl" ] || install -v -dm700 "$1/var/lib/sasl"
}
