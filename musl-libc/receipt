# SliTaz package receipt v2.

PACKAGE="musl-libc"
VERSION="1.1.16"
CATEGORY="development"
SHORT_DESC="Lightweight implementation of the standard C library"
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="MIT"
WEB_SITE="https://www.musl-libc.org/"
HOST_ARCH="i486 x86_64 arm"

TARBALL="musl-$VERSION.tar.gz"
WGET_URL="https://www.musl-libc.org/releases/$TARBALL"

SPLIT="musl-libc-dev"

# Rules to configure and make the package.
compile_rules()
{
	case $ARCH in
		i*86)   TARGET='i386';;
		x86_64) TARGET='x86_64';;
		arm*)   TARGET='ARM';;
	esac
	PREFIX='/usr/lib/musl'

	./configure \
		--prefix=$PREFIX \
		--exec-prefix=/usr \
		--target=$TARGET \
		$CONFIGURE_ARGS &&
	make &&
	make $DESTDIR=$DESTDIR install || exit 1

	mkdir -p $install/etc
	echo "$PREFIX/lib" > $install/etc/ld-musl-$TARGET.path

	for i in linux asm asm-generic; do
		ln -s /usr/include/$i $install$PREFIX/include/$i
	done

	docdir=$install/usr/share/doc/$PACKAGE-$VERSION
	mkdir -p $docdir
	cp README $docdir
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		musl-libc)
			copy etc/ *.so*
			;;
		*-dev)
			copy @dev @std @rm
			;;
	esac
}
