# SliTaz package receipt v2.

PACKAGE="graphviz"
VERSION="2.40.1"
CATEGORY="x-window"
SHORT_DESC="Automatic graph drawing"
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="Eclipse"
WEB_SITE="http://www.graphviz.org/"
LFS="http://www.linuxfromscratch.org/blfs/view/stable/general/graphviz.html"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="http://graphviz.org/pub/graphviz/stable/SOURCES/$TARBALL"

BUILD_DEPENDS="automake xorg-dev expat-dev zlib-dev libpng16-dev \
libjpeg-turbo-dev libgd-dev swig ocaml python-dev tcl-dev tk-dev librsvg-dev \
ruby-dev libcroco-dev util-linux-uuid-dev pango-dev libxml2-dev gdk-pixbuf-dev \
guile-dev pcre-dev perl-dev libtool" # php-dev lua-dev
SPLIT="graphviz-dev graphviz-doc graphviz-demo graphviz-guile graphviz-ocaml \
graphviz-perl graphviz-python graphviz-ruby graphviz-tcl graphviz"
COOKOPTS="skip-log-errors"

# FIXME: PHP and Lua support is temporarily disabled
# (PHP broken itself, Lua breaks the Graphviz)

compile_rules() {
	sed -i '/ruby/s/1\.9/2.4/'       configure.ac
	sed -i '/LIBPOSTFIX="64"/s/64//' configure.ac
	autoreconf &&

	./configure $CONFIGURE_ARGS && make && make install
}

genpkg_rules() {
	case $PACKAGE in
		*-dev)
			copy @dev
			DEPENDS="graphviz graphviz-guile graphviz-ocaml graphviz-perl \
			graphviz-python graphviz-ruby graphviz-tcl \
			bzip2-dev cairo-dev expat-dev fontconfig-dev freetype-dev \
			gdk-pixbuf-dev glib-dev gmp-dev harfbuzz-dev libjpeg-turbo-dev \
			libcroco-dev libffi-dev libgd-dev libpng16-dev librsvg-dev libtool \
			libxml2-dev pango-dev pcre-dev util-linux-blkid-dev \
			util-linux-mount-dev util-linux-uuid-dev xorg-libX11-dev \
			xorg-libXau-dev xorg-libXdmcp-dev xorg-libXext-dev xorg-libXpm-dev \
			xorg-libXrender-dev xorg-libxcb-dev xorg-pixman-dev xz-dev zlib-dev"
			SUGGESTED="guile-dev ocaml perl-dev python-dev ruby-dev tcl-dev"
			;;
		*-doc)
			CAT="doc|documentation"
			copy doc/
			;;
		*-demo)
			CAT="development|demo"
			copy demo/
			DEPENDS="graphviz perl python ruby tcl"
			;;
		*-guile)
			copy guile/ @rm
			CAT="x-window|Guile bindings"
			DEPENDS="graphviz expat gmp guile libltdl zlib"
			;;
		*-ocaml)
			copy ocaml/ @rm
			CAT="x-window|Ocaml bindings"
			DEPENDS="graphviz expat libltdl zlib"
			;;
		*-perl)
			copy perl/ perl5/ @rm
			CAT="x-window|Perl bindings"
			DEPENDS="graphviz expat libltdl perl perl-core zlib"
			;;
		*-python)
			copy python/ python2.7/ @rm
			CAT="x-window|Python bindings"
			DEPENDS="graphviz expat libltdl python zlib"
			;;
		*-ruby)
			copy ruby/ @rm
			CAT="x-window|Python bindings"
			DEPENDS="graphviz expat gmp libltdl libruby zlib"
			;;
		*-tcl)
			copy tcl/ tcl8.6/ @rm
			CAT="x-window|Tcl bindings"
			DEPENDS="graphviz bzlib cairo expat fontconfig freetype glib \
			libffi libgd libharfbuzz libjpeg-turbo libltdl liblzma libpng16 \
			libxml2 pango pcre xorg-libX11 xorg-libXau xorg-libXdmcp \
			xorg-libXext xorg-libXpm xorg-libXrender xorg-libxcb xorg-pixman \
			zlib"
			;;
		graphviz)
			copy @std @rm
			DEPENDS="bzlib cairo expat fontconfig freetype gdk-pixbuf glib \
			libcroco libffi libgd libharfbuzz libjpeg-turbo libltdl liblzma \
			libpng16 librsvg libxml2 pango pcre util-linux-blkid \
			util-linux-mount util-linux-uuid xorg-libICE xorg-libSM \
			xorg-libX11 xorg-libXau xorg-libXaw xorg-libXdmcp xorg-libXext \
			xorg-libXmu xorg-libXpm xorg-libXrender xorg-libXt xorg-libxcb \
			xorg-pixman zlib"
			;;
	esac
}
