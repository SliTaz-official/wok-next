# SliTaz package receipt v2.

PACKAGE="llvm"
VERSION="5.0.0"
CATEGORY="development"
SHORT_DESC="LLVM (Low Level Virtual Machine): collection of modular and reusable compiler and toolchain technologies"
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="MIT"
WEB_SITE="http://llvm.org/"

TARBALL="$PACKAGE-$VERSION.src.tar.xz"
WGET_URL="${WEB_SITE}releases/$VERSION/$TARBALL"

BUILD_DEPENDS="cmake zlib-dev libffi-dev python"
SPLIT="llvm-dev llvm-libs"

compile_rules() {
	mkdir build && cd build &&
	CC=gcc CXX=g++ \
	cmake \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DLLVM_ENABLE_FFI=ON \
		-DCMAKE_BUILD_TYPE=Release \
		-DBUILD_SHARED_LIBS=ON \
		-DLLVM_TARGETS_TO_BUILD="host;AMDGPU" \
		-Wno-dev .. &&
	make &&
	make install
}

genpkg_rules() {
	case $PACKAGE in
		llvm)
			DEPENDS="libffi gcc-lib-base llvm-libs"
			copy bin/
			;;
		llvm-dev)
			DEPENDS="llvm"
			copy include/ cmake/
			;;
		llvm-libs)
			CAT="libs|libraries"
			DEPENDS="libffi gcc-lib-base"
			copy *.so*
			;;
	esac
}
