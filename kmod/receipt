# SliTaz package receipt v2.

PACKAGE="kmod"
VERSION="23"
CATEGORY="base-system"
SHORT_DESC="Linux kernel modules tools"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://www.kernel.org/pub/linux/utils/kernel/kmod/"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$WEB_SITE$TARBALL"

BUILD_DEPENDS="zlib-dev xz-dev tar"
BUILD_DEPENDS_arm="zlib-dev xz-dev"
SPLIT="kmod-dev"

# Rules to configure and make the package.
compile_rules()
{
	./configure \
		--bindir=/bin \
		--with-rootlibdir=/lib \
		--sysconfdir=/etc \
		--with-zlib \
		--with-xz \
		$CONFIGURE_ARGS &&
	make && make install

	# compatibility with module-init-tools
	# (the package that previously handled Linux kernel modules)
	mkdir $install/sbin
	for tool in depmod insmod lsmod modinfo modprobe rmmod; do
		ln -s ../bin/kmod $install/sbin/$tool
	done
	ln -s kmod $install/bin/lsmod
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		kmod)
			copy @std
			PROVIDE="modules-init-tools depmod"
			DEPENDS="zlib liblzma"
			;;
		*-dev)
			copy @dev
			DEPENDS="kmod xz-dev pkg-config"
			;;
	esac
}
