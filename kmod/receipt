# SliTaz package receipt.

PACKAGE="kmod"
VERSION="23"
CATEGORY="base-system"
SHORT_DESC="Linux kernel modules tools."
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://www.kernel.org/pub/linux/utils/kernel/kmod/"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$WEB_SITE$TARBALL"

DEPENDS="zlib liblzma"
BUILD_DEPENDS="zlib-dev liblzma-dev tar"
PROVIDE="modules-init-tools"

# Handle cross compilation. ARM use build host: tar
case "$ARCH" in
	arm) BUILD_DEPENDS="wget zlib-dev liblzma-dev" ;;
esac

# Rules to configure and make the package.
compile_rules()
{
	./configure \
		--bindir=/bin \
		--with-rootlibdir=/lib \
		--sysconfdir=/etc \
		--with-zlib \
		--with-xz \
		$CONFIGURE_ARGS &&
	make && make install

	# compatibility with module-init-tools
	# (the package that previously handled Linux kernel modules)
	mkdir $install/sbin
	for tool in depmod insmod lsmod modinfo modprobe rmmod; do
		ln -s ../bin/kmod $install/sbin/$tool
	done
	ln -s kmod $install/bin/lsmod
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cook_copy_folders bin sbin
	cook_copy_files *.so*
}
