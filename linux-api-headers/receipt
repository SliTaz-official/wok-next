# SliTaz package receipt v2.

PACKAGE="linux-api-headers"
VERSION="4.9.30"
KBASEVER="4.9"
CATEGORY="development"
SHORT_DESC="Kernel headers sanitized for use in userspace"
MAINTAINER="devel@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://www.kernel.org/"

TARBALL="linux-$KBASEVER.tar.xz"
WGET_URL="https://www.kernel.org/pub/linux/kernel/v4.x/$TARBALL"

PROVIDE="linux-headers linux64-api-headers linux64-headers"
BUILD_DEPENDS="bash perl patch"
SIBLINGS="linux linux-dev linux-man"

if [ "$KBASEVER" != "${VERSION%.0}" ]; then
	PATCH="$(dirname $WGET_URL)/patch-$VERSION.xz"
	EXTRA_SOURCE_FILES="$(basename $PATCH)"
fi

# Rules to configure and make the package.
compile_rules()
{
	# Update sources to the $VERSION using base sources ($KBASEVER) and patch
	if [ "$KBASEVER" != "${VERSION%.0}" ]; then
		[ -s $SRC/$(basename $PATCH) ] || wget $PATCH -O $SRC/$(basename $PATCH)
		# don't patch twice for `cook $PACKAGE --continue`
		if [ ! -f "done.patch-$VERSION" ]; then
			xzcat $SRC/$(basename $PATCH) | patch -Np1
			touch done.patch-$VERSION
		fi
	fi

#	# Get and apply Aufs patches
#	. $WOK/linux/stuff/tools/aufs-patches

	make mrproper &&
	make headers_check &&
	make INSTALL_HDR_PATH=$DESTDIR/usr headers_install

	find $install \( -name .install -o -name ..install.cmd \) -delete
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	copy @dev
}
