# SliTaz package receipt.

PACKAGE="linux-api-headers"
VERSION="4.9.0"
KBASEVER="$(echo $VERSION | cut -d. -f1,2)"
CATEGORY="development"
SHORT_DESC="Kernel headers sanitized for use in userspace."
MAINTAINER="devel@slitaz.org"
LICENSE="GPL2"
SOURCE="linux"
WEB_SITE="https://www.kernel.org/"

TARBALL="$SOURCE-$KBASEVER.tar.xz"
WGET_URL="https://www.kernel.org/pub/linux/kernel/v4.x/$TARBALL"

PROVIDE="linux-headers linux64-api-headers linux64-headers"
BUILD_DEPENDS="bash perl"

if [ "$KBASEVER" != "${VERSION%.0}" ]; then
	PATCH="$(dirname $WGET_URL)/patch-$VERSION.xz"
	EXTRA_SOURCE_FILES="$(basename $PATCH)"
fi

# Rules to configure and make the package.
compile_rules()
{
	if [ "$KBASEVER" != "${VERSION%.0}" ]; then
		[ -s $SRC/$(basename $PATCH) ] ||
		wget --no-check-certificate $PATCH -O $SRC/$(basename $PATCH)
		xzcat $SRC/$(basename $PATCH) | patch -Np1
		touch done.patch-$VERSION
	fi

	make mrproper &&
	make headers_check &&
	make INSTALL_HDR_PATH=$DESTDIR/usr headers_install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr
	cp -a $install/usr/include $fs/usr
	rm -f $(find $fs -name .install -or -name ..install.cmd)
}
