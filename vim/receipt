# SliTaz package receipt.

PACKAGE="vim"
VERSION="7.4"
CATEGORY="editors"
SHORT_DESC="Advanced text editor"
MAINTAINER="erjo@slitaz.org"
LICENSE="other"
WEB_SITE="http://www.vim.org/"
CONFIG_FILES="/etc/vim/vimrc"
TAGS="text-editor"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="ftp://ftp.vim.org/pub/vim/unix/$TARBALL"

DEPENDS="ncurses acl attr diffutils"
# python may be removed after "ncursesw problem" solved
BUILD_DEPENDS="python ncurses-dev acl-dev diffutils gettext"
SIBLINGS="vim-tiny"

# Rules to configure and make the package.
compile_rules()
{
	echo '#define SYS_VIMRC_FILE "/etc/vimrc"' >> src/feature.h

	./configure \
		--without-x \
		--disable-gui \
		--enable-multibyte \
		$CONFIGURE_ARGS &&
	make && make install

	mkdir -p $install/etc/vim
	cp -a $src/runtime/vimrc_example.vim $install/etc/vim/vimrc

	mkdir -p $install/usr/share/doc
	ln -s ../vim/vim*/doc $install/usr/share/doc/vim-$VERSION
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cook_copy_folders etc bin vim
}

post_install()
{
	cmd=$(readlink "$1/bin/vi")
	if [ "$cmd" != '/usr/bin/vim' ]; then
		echo
		echo "**** Actual VI link : $cmd"
		echo
		echo -n 'Do you want vim for /bin/vi (y/N)? : '; read -t 30 anser
		if [ "$anser" == 'y' ]; then
			echo
			echo -n 'Removing vi link to make a new one pointing on /usr/bin/vim...'
			rm "$1/bin/vi" && ln -sf /usr/bin/vim "$1/bin/vi"
			status
		else
			echo
			echo "Leaving /bin/vi to : $cmd"
		fi
	fi
}

post_remove()
{
	ln -sf /bin/busybox "$1/bin/vi"
}
