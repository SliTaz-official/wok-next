# SliTaz package receipt v2.

PACKAGE="mplayer-cli"
VERSION="1.3.0"
CATEGORY="multimedia"
SHORT_DESC="The Ultimate Movie Player For Linux (with minimal depends)"
MAINTAINER="psychomaniak@xakep.ru"
LICENSE="GPL2"
WEB_SITE="http://www.mplayerhq.hu/design7/news.html"
REPOLOGY="mplayer"

TARBALL="MPlayer-$VERSION.tar.xz"
WGET_URL="http://www1.mplayerhq.hu/MPlayer/releases/$TARBALL"

BUILD_DEPENDS="ncurses-dev libxv-dev alsa-lib-dev libxdamage-dev \
giflib-dev libxxf86vm-dev xorgproto freetype-dev fontconfig-dev \
zlib-dev yasm libmad-dev sdl-dev gnutls-dev"

compile_rules() {
	case "$ARCH" in
		i?86) ARCH_ARGS="--target=i486-linux --enable-runtime-cpudetection";;
	esac

	./configure \
		--prefix=/usr \
		--confdir=/etc/mplayer \
		--libdir=/usr/lib/mplayer \
		--language="en de es fr it pl ru" \
		--enable-menu \
		--disable-mencoder \
		--disable-gl \
		--disable-jack \
		--disable-liblzo \
		--disable-libdv \
		--disable-fribidi \
		--disable-ivtv \
		--disable-smb \
		--disable-openal \
		--disable-faac \
		--disable-speex \
		--disable-esd \
		--disable-lirc \
		--disable-lircc \
		$ARCH_ARGS &&
	make $MAKEFLAGS &&
	make DESTDIR=$install install
}

genpkg_rules() {
	mkdir -p $fs/usr/share/mplayer
	cp -a $install/usr/bin $fs/usr
	cp -a $install/etc $fs
	cp $src/etc/example.conf $fs/etc/mplayer
	# Add /etc/mplayer/input.conf
	cp $stuff/input.conf $fs/etc/mplayer
	# Config
	cp $stuff/mplayer.conf $fs/etc/mplayer
	# No-gui, OSD ($username@slitaz:~$ mplayer -menu filename)
	mkdir -p $fs/usr/share/applications
	cp -f $stuff/mplayer.desktop $fs/usr/share/applications/mplayer.desktop
	cp $src/etc/*menu.conf $fs/etc/mplayer
	# Font
	cd $fs/usr/share/mplayer && ln -s ../fonts/truetype/ttf-dejavu/DejaVuSans.ttf subfont.ttf
	DEPENDS="alsa-lib libbzip2 fontconfig freetype giflib libgnutls libmad libpng \
	sdl ncurses libx11 libxext libxv libxxf86vm zlib"
	PROVIDE="mplayer"
}
