# SliTaz package receipt v2.

PACKAGE="lxqt-common"
VERSION="0.11.2"
CATEGORY="system-tools"
SHORT_DESC="Common files for LXQt"
MAINTAINER="al.bobylev@gmail.com"
LICENSE="GPL2"
WEB_SITE="https://github.com/lxde/lxqt-common"
LFS="http://www.linuxfromscratch.org/blfs/view/stable/lxqt/lxqt-common.html"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="https://github.com/lxde/lxqt-common-deprecated--do-not-use-anymore-/releases/download/$VERSION/$TARBALL"

BUILD_DEPENDS="lxqt-build-tools"
SPLIT="lxqt-themes lxqt-common"

compile_rules() {
	sed -i '/TryExec/ s|=|=/usr/bin/|' xsession/lxqt.desktop.in

	mkdir build; cd build
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		.. &&
	make &&
	mkdir -p $install/usr/share/lxqt/graphics &&
	make install
}

genpkg_rules() {
	case $PACKAGE in
		lxqt-themes)
			copy themes/
			rm -r $fs/usr/share/lxqt/themes/system/ $fs/usr/share/lxqt/themes/frost/
			CAT="customization|themes"
			TAGS="LXQt"
			;;
		lxqt-common)
			copy @std
			remove_already_packed
			TAGS="LXQt window-manager"
			DEPENDS="dbus xorg-xmessage xorg-xprop"
			;;
	esac
}

# SLiM can use /usr/share/xsessions/ too... ?
# Also, we may not use SLiM at all.
post_install_lxqt_common() {
	if [ -e "$1/etc/slim.conf" ]; then
		res=$(cat "$1/etc/slim.conf" | grep '^session' | sed 's|sessions. *||')
		# Adding WM to SLiM available sessions.
		if ! echo "$res" | grep -q lxqt; then
			action "Adding lxqt to /etc/slim.conf..."
			sed -i "s|^sessions.*|sessions            $res,lxqt|" "$1/etc/slim.conf"
			status
		fi
	fi
}

post_remove_lxqt_common() {
	if [ -e "$1/etc/slim.conf" ]; then
		# Remove WM from SLiM available sessions.
		if grep -q lxqt "$1/etc/slim.conf"; then
			sed -i 's|,lxqt||' "$1/etc/slim.conf"
		fi
	fi
}

