# SliTaz package receipt v2.

PACKAGE="libboost"
VERSION="1.66.0"
CATEGORY="meta"
SHORT_DESC="Boost C++ libraries"
MAINTAINER="chadi.elahmad@gmail.com"
LICENSE="MIT"
WEB_SITE="http://www.boost.org/"
LFS="http://www.linuxfromscratch.org/blfs/view/stable/general/boost.html"
REPOLOGY="boost"

TARBALL="boost-$VERSION.tar.bz2"
WGET_URL="https://dl.bintray.com/boostorg/release/$VERSION/source/boost_${VERSION//./_}.tar.bz2"

BUILD_DEPENDS="icu-dev zlib-dev bzip2-dev python-dev"
l="libboost"
SPLIT="$l-atomic $l-chrono $l-container $l-context $l-coroutine $l-date-time \
$l-fiber $l-filesystem $l-graph $l-iostreams $l-locale $l-log $l-math \
$l-math-tr1 $l-prg-exec-monitor $l-program-options $l-python $l-random \
$l-regex $l-serialization $l-signals $l-system $l-thread $l-timer \
$l-type-erasure $l-unit-test-framework $l-wave $l-wserialization $l-doc $l-dev"

# About splitting: there's complex relationships between header files.
# Previously, for example, the /usr/include/boost/chrono/* files were packed
# into libboost-chrono-dev package. And so on for many /usr/include/boost/*/
#
# But, for example:
# 1. /usr/include/boost/chrono/config.hpp (former libboost-chrono-dev package)
# includes <boost/config.hpp> (libboost-dev package)
# 2. /usr/include/boost/compute/detail/duration.hpp (former libboost-dev package)
# includes <boost/chrono/duration.hpp> (libboost-chrono package)
#
# And many other circular dependencies between libboost-dev and libboost-*-dev
# packages.
#
# Solution: make single solid big libboost-dev package with all development
# files.
#
# How to change dependencies of packages that depends on libboost: substitute
# libboost-x-dev by the pair libboost-x and libboost-dev.


compile_rules() {
	./bootstrap.sh --prefix=$install/usr &&
	./b2 stage   threading=multi link=shared &&
	./b2 install threading=multi link=shared || return 1

	cook_pick_docs doc/html/*

	find $install -name '*.hpp' -exec chmod 644 '{}' \;
}

genpkg_rules() {
	DEPENDS=" "
	case $PACKAGE in
		*-chrono)				DEPENDS="$l-system";;
		*-coroutine)			DEPENDS="$l-chrono $l-context $l-system $l-thread";;
		*-fiber)				DEPENDS="$l-context $l-filesystem $l-system";;
		*-filesystem)			DEPENDS="$l-system";;
		*-graph)				DEPENDS="$l-regex icu libicu";;
		*-iostreams)			DEPENDS="bzlib zlib";;
		*-locale)				DEPENDS="$l-chrono $l-system $l-thread icu libicu";;
		*-log)					DEPENDS="$l-atomic $l-chrono $l-date-time $l-filesystem $l-regex $l-system $l-thread icu libicu";;
		*-prg-exec-monitor)		DEPENDS="$l-system $l-timer";;
		*-random)				DEPENDS="$l-system";;
		*-regex)				DEPENDS="icu libicu";;
		*-thread)				DEPENDS="$l-system";;
		*-timer)				DEPENDS="$l-chrono $l-system";;
		*-type-erasure)			DEPENDS="$l-chrono $l-system $l-thread";;
		*-unit-test-framework)	DEPENDS="$l-system $l-timer";;
		*-wave)					DEPENDS="$l-chrono $l-date-time $l-filesystem $l-system $l-thread";;
		*-wserialization)		DEPENDS="$l-serialization";;
	esac

	case $PACKAGE in
		libboost)
			DEPENDS="$l-date-time $l-iostreams $l-regex $l-serialization \
			$l-system $l-thread"
			CAT="meta|meta-package to install base modules"
			;;
		*-doc)
			copy doc/
			CAT="doc|documentation"
			;;
		libboost-dev)
			copy @dev @rm
			;;
		*)
			p=${PACKAGE#*-}
			copy libboost_${p//-/_}*.so*
			CAT="libdevel|${PACKAGE#*-}"
			;;
	esac

	case $PACKAGE in
		*-math)	rm -f $fs/usr/lib/*math_tr1*.so*;;
	esac
}
