# SliTaz package receipt v2.

PACKAGE="fltk-2.0.x"
VERSION="r7725"
CATEGORY="system-tools"
SHORT_DESC="Fast Light Tool Kit (provide fluid)"
MAINTAINER="devel@slitaz.org"
LICENSE="LGPL2"
WEB_SITE="https://www.fltk.org/index.php"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="subversion|http://svn.easysw.com/public/fltk/fltk/trunk"
BRANCH="${VERSION#r}"

BUILD_DEPENDS="libxft-dev glu glu-dev mesa mesa-dev \
subversion autoconf xorg-dev libpng12-dev"
SPLIT="$PACKAGE-dev $PACKAGE-fluid2 $PACKAGE-gl"

compile_rules() {
	sed -i 's/0xAA\([,}]\)/-86\1/g' src/UpBox.cxx
	find -name Makefile | sed 's/Makefile/makedepend/' | xargs touch -d 197001010000
	  patch -p0 src/filename_list.cxx <<EOF
66c66
<   int n = scandir(d, list, 0, (int(*)(const void*,const void*))sort);
---
>   int n = scandir(d, list, 0, (int(*)(const dirent64**,const dirent64**))sort);
EOF
	autoconf
	export LD_LIBRARY_PATH="/lib:/usr/lib:$src/lib"

	./configure \
		--prefix=/usr \
		--mandir=/usr/share/man \
		--enable-shared \
		--enable-xft \
		$CONFIGURE_ARGS &&
	make &&
	cp -f fltk2-config /usr/bin &&
	make DESTDIR=$install install
}

genpkg_rules() {
	case $PACKAGE in
		fltk-2.0.x)
			DEPENDS="expat fontconfig freetype jpeg libx11 \
			libxau libxdmcp libxext libxft \
			libxrender zlib libpng12 libxi \
			libxinerama gcc-lib-base"
			mkdir -p $fs/usr/lib
			cp -a $install/usr/lib/*.so* $fs/usr/lib
			# Remove gl support --> fltk-2.0.x-gl
			rm $fs/usr/lib/libfltk2*gl*
			;;
		*-dev)
			DEPENDS="fltk-2.0.x"
			mkdir -p $fs/usr/bin $fs/usr/lib
			cp -a $install/usr/bin/fltk2-config $fs/usr/bin
			cp -a $install/usr/lib/*.*a $fs/usr/lib
			cp -a $install/usr/include $fs/usr
			;;
		*-fluid2)
			CAT="development|designer"
			DEPENDS="fltk-2.0.x"
			mkdir -p $fs/usr/bin
			cp -a $install/usr/bin/fluid2 $fs/usr/bin
			;;
		*-gl)
			CAT="x-window|GL library"
			DEPENDS="mesa glu expat fontconfig libxft \
			libxi libxinerama libxext gcc-lib-base"
			mkdir -p $fs/usr/lib
			cp -a $install/usr/lib/libfltk2*gl*.so* $fs/usr/lib
			;;
	esac
}
