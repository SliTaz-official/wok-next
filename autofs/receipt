# SliTaz package receipt v2.

PACKAGE="autofs"
VERSION="5.1.5"
CATEGORY="system-tools"
SHORT_DESC="Linux automounter"
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://mirrors.edge.kernel.org/pub/linux/daemons/autofs/v5/"
LFS="http://www.linuxfromscratch.org/blfs/view/svn/general/autofs.html"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$WEB_SITE/$TARBALL"

BUILD_DEPENDS="flex libxml2-dev openldap-dev cyrus-sasl-dev openssl-dev \
krb5-dev rpcsvc-proto libtirpc-dev coreutils-operations"

compile_rules() {
	./configure \
		--with-libtirpc \
		$CONFIGURE_ARGS &&
	make autofsconfdir=/etc &&
	make autofsconfdir=/etc DESTDIR=$install install || return 1

	install -Dm755 $stuff/etc/init.d/autofs $install/etc/init.d/autofs
	install -Dm644 $stuff/etc/auto.master   $install/etc/auto.master
	install -Dm644 $stuff/etc/auto.misc     $install/etc/auto.misc
}

genpkg_rules() {
	copy @std
	rm $fs/usr/lib/autofs/lookup_nis.so # broken link
	DEPENDS="libkrb5 libldap libsasl libtirpc libxml2   linux-autofs"
	TAZPANEL_DAEMON="man|help::automount|edit::/etc/auto.misc|options::AUTOMOUNT_OPTIONS|web::$WEB_SITE"
	TAGS="filesystem"
}

post_install() {
	mkdir -p "$1/mnt/auto" 2>/dev/null
}
