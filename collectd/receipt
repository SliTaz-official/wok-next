# SliTaz package receipt v2.

PACKAGE="collectd"
VERSION="5.1.0"
CATEGORY="network"
SHORT_DESC="System Statistics Collection Daemon"
MAINTAINER="erjo@slitaz.org"
LICENSE="GPL2"
WEB_SITE="http://collectd.org"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="http://collectd.org/files/$TARBALL"

BUILD_DEPENDS="slitaz-toolchain rrdtool-dev perl"
SPLIT="collectd collectd-dev"

compile_rules() {
	sed -i 's|_BSD_SOURCE|_DEFAULT_SOURCE|' src/*.c configure*

	./configure \
		--enable-interface \
		--enable-load \
		--enable-cpu \
		--enable-disk \
		--enable-logfile \
		--enable-syslog \
		--enable-csv\
		--enable-rrdtool \
		--with-librrdtool=/usr/include \
		--disable-all-plugins \
		--sysconfdir=/etc/collectd \
		$CONFIGURE_ARGS &&
	make &&
	make DESTDIR=$DESTDIR install || return 1

	# Add init script and fixes
	install -Dm755 $stuff/collectd $install/etc/init.d/collectd
	chmod 0644 $install/etc/collectd/*
}

genpkg_rules() {
	case $PACKAGE in
		collectd)
			copy @std
			DEPENDS="rrdtool perl"
			CONFIG_FILES="/etc/collectd/collectd.conf"
			;;
		collectd-dev)
			copy @dev
			;;
	esac
}
