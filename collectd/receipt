# SliTaz package receipt v2.

PACKAGE="collectd"
VERSION="5.1.0"
CATEGORY="network"
SHORT_DESC="System Statistics Collection Daemon"
MAINTAINER="erjo@slitaz.org"
LICENSE="GPL2"
TARBALL="$PACKAGE-$VERSION.tar.gz"
WEB_SITE="http://collectd.org"
WGET_URL="http://collectd.org/files/$TARBALL"
CONFIG_FILES="/etc/collectd/collectd.conf"

BUILD_DEPENDS="slitaz-toolchain rrdtool-dev perl"
SPLIT="collectd collectd-dev"

# Rules to configure and make the package.
compile_rules()
{
	sed -i 's|_BSD_SOURCE|_DEFAULT_SOURCE|' src/*.c configure*
	./configure \
		--prefix=/usr \
		--localstatedir=/var \
		--enable-interface \
		--enable-load \
		--enable-cpu \
		--enable-disk \
		--enable-logfile \
		--enable-syslog \
		--enable-csv\
		--enable-rrdtool \
		--with-librrdtool=/usr/include \
		--disable-all-plugins \
		--sysconfdir=/etc/collectd \
		--localstatedir=/var \
		$CONFIGURE_ARGS &&
	make && make DESTDIR=$DESTDIR install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
	collectd)
		DEPENDS="rrdtool perl"
		mkdir -p $fs/usr/lib/collectd \
			$fs/usr/share \
			$fs/etc/init.d
	
		cp -a $install/etc $fs/
		cp -a $install/var $fs/
		cp -a $install/usr/share/collectd $fs/usr/share
		cp -a $install/usr/bin $fs/usr
		cp -a $install/usr/sbin $fs/usr
		cp -a $install/usr/lib/*.so* $fs/usr/lib
		cp -a $install/usr/lib/collectd/*.so $fs/usr/lib/collectd
		cp -a $install/usr/lib/perl5 $fs/usr/lib
	
		# Add init script and fixes
		install -g root -o root -m 0755 $stuff/collectd $fs/etc/init.d
		chmod 0644 $fs/etc/collectd/*
		;;
	collectd-dev)
		mkdir -p $fs/usr/lib
		cp -a $install/usr/include $fs/usr
		cp -a $install/usr/lib/*.*a $fs/usr/lib
		cp -a $install/usr/lib/pkgconfig $fs/usr/lib
		;;
	esac
}
