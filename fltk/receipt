# SliTaz package receipt v2.

PACKAGE="fltk"
VERSION="1.3.4"
CATEGORY="system-tools"
SHORT_DESC="Fast Light Tool Kit"
MAINTAINER="pankso@slitaz.org"
LICENSE="LGPL2"
WEB_SITE="http://www.fltk.org/"
LFS="http://www.linuxfromscratch.org/blfs/view/stable/x/fltk.html"

TARBALL="$PACKAGE-$VERSION-source.tar.gz"
WGET_URL="http://fltk.org/pub/fltk/$VERSION/$TARBALL"

BUILD_DEPENDS_arm="jpeg-dev libpng16-dev xorg-libXft-dev"
BUILD_DEPENDS="alsa-lib-dev libjpeg-turbo-dev zlib-dev libpng16-dev \
xorg-libX11-dev xorg-libICE-dev xorg-libSM-dev mesa-dev xorg-libXinerama-dev \
freetype-dev xorg-libXft-dev xorg-libXcursor-dev xorg-xprop"
SPLIT="fltk-blocks fltk-checkers fltk-sudoku fltk-colbrowser fltk-editor \
fltk-doc fltk fltk-dev"
COOKOPTS="!menus"

compile_rules() {
	case "$ARCH" in
		arm) ARCH_ARGS="--x-includes=/cross/$ARCH/sysroot/usr/include \
			--x-libraries=/cross/$ARCH/sysroot/usr/lib";;
		*) ARCH_ARGS='';;
	esac

	sed -i -e '/cat./d' documentation/Makefile

	fix ld
	./configure \
		--enable-shared \
		--enable-xft \
		--enable-threads \
		$ARCH_ARGS \
		$CONFIGURE_ARGS &&
	sed -i 's| -shared | -Wl,-Os,--as-needed\0|g' makeinclude &&
	sed -i s'#"rgb.txt"#"/usr/share/fltk/rgb.txt"#' test/colbrowser.cxx &&
	make $MAKEFLAGS &&
	make DESTDIR=$DESTDIR install || return 1

	sed -i '/mimelnk/d' fluid/Makefile
	make -C fluid install-linux || return 1

	make -C test  install-linux || return 1

	for game in blocks checkers sudoku; do
		for file in \
		/usr/bin/$game \
		/usr/share/icons/hicolor/128x128/apps/$game.png \
		/usr/share/icons/hicolor/32x32/apps/$game.png \
		/usr/share/applications/$game.desktop; do
			mv $install$file $install${file/$game/fltk-$game}
		done
		sed -i 's|Exec=|Exec=fltk-|; s|Icon=|Icon=fltk-|; /TryExec/d' \
			$install/usr/share/applications/fltk-$game.desktop
	done

	install -m755  $src/test/colbrowser $install/usr/bin/fltk-colbrowser
	install -m755  $src/test/editor     $install/usr/bin/fltk-editor
	install -Dm644 $src/test/rgb.txt    $install/usr/share/fltk/rgb.txt
}

genpkg_rules() {
	case $PACKAGE in
		fltk-blocks)
			copy $PACKAGE*
			CAT="games|FLTK Blocks game"
			DEPENDS="alsa-lib fontconfig xorg-libX11 xorg-libXcursor \
			xorg-libXext xorg-libXfixes xorg-libXft xorg-libXinerama \
			xorg-libXrender"
			;;
		fltk-checkers)
			copy $PACKAGE*
			CAT="games|FLTK Checkers game"
			DEPENDS="fontconfig xorg-libX11 xorg-libXcursor xorg-libXext \
			xorg-libXfixes xorg-libXft xorg-libXinerama xorg-libXrender"
			;;
		fltk-sudoku)
			copy $PACKAGE*
			CAT="games|FLTK Sudoku game"
			DEPENDS="alsa-lib fontconfig libjpeg-turbo libpng16 xorg-libX11 \
			xorg-libXcursor xorg-libXext xorg-libXfixes xorg-libXft \
			xorg-libXinerama xorg-libXrender"
			;;
		fltk-colbrowser)
			copy $PACKAGE* rgb.txt
			CAT="graphics|FLTK Color browser"
			DEPENDS="fontconfig xorg-libX11 xorg-libXcursor xorg-libXext \
			xorg-libXfixes xorg-libXft xorg-libXinerama xorg-libXrender"
			;;
		fltk-editor)
			copy $PACKAGE*
			CAT="development|FLTK text editor"
			DEPENDS="fontconfig xorg-libX11 xorg-libXcursor xorg-libXext \
			xorg-libXfixes xorg-libXft xorg-libXinerama xorg-libXrender"
			;;
		fltk-doc)
			copy doc/
			CAT="development|FLTK documentation and examples"
			;;
		fltk)
			copy @std @rm
			case "$SLITAZ_ARCH" in
				arm*)
					DEPENDS="expat fontconfig freetype jpeg libpng16 \
					xorg-libXft" ;;
				*)
					DEPENDS="fontconfig libjpeg-turbo libpng16 mesa \
					xorg-libX11 xorg-libXcursor xorg-libXext xorg-libXfixes \
					xorg-libXft xorg-libXinerama xorg-libXrender"
			esac
			;;
		fltk-dev)
			copy @dev @rm # remove examples in doc
			DEPENDS="fltk"
			;;
	esac
}
