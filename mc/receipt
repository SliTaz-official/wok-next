# SliTaz package receipt.

PACKAGE="mc"
VERSION="4.8.18"
CATEGORY="system-tools"
SHORT_DESC="Midnight Commander - ncurses based file manager."
MAINTAINER="erjo@slitaz.org"
LICENSE="GPL3"
WEB_SITE="http://midnight-commander.org/"
TAGS="file-manager text-editor"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="http://ftp.midnight-commander.org/$TARBALL"

SUGGESTED="gpm xz cdrkit-isoinfo lynx w3m wv poppler-apps file"
DEPENDS="ncurses glib e2fsprogs util-linux-blkid libssh2 libssl libcrypto zlib pcre"
BUILD_DEPENDS="gpm-dev glib-dev ncurses-dev util-linux-mount-dev \
util-linux-blkid-dev util-linux-uuid-dev check-dev gettext libssh2-dev"

COOKOPTS="!menus"

# Rules to configure and make the package.
compile_rules()
{
	sed -i 's/lzma -cd/lzcat/' $src/src/editor/edit.c

	./configure \
		--enable-charset \
		--with-gpm-mouse \
		--with-screen=ncurses \
		--sysconfdir=/etc \
		$CONFIGURE_ARGS &&
	make && make install

	mkdir -p $install/usr/share/terminfo/s
	cp -a /usr/share/terminfo/s/screen-256color $install/usr/share/terminfo/s

	mkdir -p $install/usr/share/applications
	cp $stuff/*.desktop $install/usr/share/applications

	install -m755 $stuff/mc.sh $install/usr/bin

	chown -R root:root $install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cook_copy_folders bin mc terminfo applications

	sed -i 's#|profile|#&receipt|#' $fs/usr/share/mc/syntax/Syntax
	sed -i 's/lzma -dc/lzcat/g'     $fs/usr/libexec/mc/ext.d/archive.sh
}
