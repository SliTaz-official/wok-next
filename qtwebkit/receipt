# SliTaz package receipt.

PACKAGE="qtwebkit"
VERSION="5.212.0-alpha2"
CATEGORY="network"
SHORT_DESC="KDE version of Qt Webkit browser engine."
MAINTAINER="psychomaniak@xakep.ru"
LICENSE="GPL"
TARBALL="$PACKAGE-$VERSION.tar.xz"
WEB_SITE="http://code.qt.io/cgit/qt/qtwebkit.git/"
WEB_SITE_2="https://github.com/annulen/webkit/"
WGET_URL="${WEB_SITE_2}releases/download/${TARBALL/.tar*/}/$TARBALL"

PROVIDE="libQtWebkit"
CONFIG_FILES="/etc/fonts/conf.d/10-QtWebkit-monospace.conf"

DEPENDS="qt5 sqlite gstreamer1 gst1-plugins-base"
BUILD_DEPENDS="qt5-dev cmake bison flex gperf ruby-dev xorg-dev mesa17-dev \
freetype-dev fontconfig-dev sqlite-dev libpng-dev libjpeg-turbo-dev icu-dev \
glib-dev zlib-dev libxslt-python libxslt-dev gstreamer1-dev \
gst1-plugins-base-dev hyphen-dev "

compile_rules()
{
#	sed 's|FixedFont, default.*$|FixedFont, QLatin1String("monospace"));|' -i \
#		$src/Source/WebKit/qt/Api/qwebsettings.cpp
	mkdir -p WebKitBuild/Release
	cd WebKitBuild/Release
        export CFLAGS=${CFLAGS/486/686}
	export CXXFLAGS=${CXXFLAGS/486/686}
	#QTDIR=/usr
	QMAKE_CFLAGS=$CFLAGS QMAKE_CXXFLAGS=$CXXFLAGS \
	cmake	-DPORT=Qt \
		-DCMAKE_BUILD_TYPE=Release \
		-DENABLE_ALLINONE_BUILD=OFF \
		-DENABLE_JIT=OFF \
		-DENABLE_YARR_JIT=0 \
		-DENABLE_ASSEMBLER=0 \
		-DENABLE_SMOOTH_SCROLLING=1 \
	../..
	make
	make install
#	make INSTALL_ROOT=$DESTDIR -C WebKitBuild/Release install
}

genpkg_rules()
{
	mkdir -p $fs/usr/lib $fs/usr/bin $fs/etc/fonts/conf.d
	cat > $fs/etc/fonts/conf.d/10-QtWebkit-monospace.conf <<EOT
<fontconfig><alias>
 <family>monospace</family>
  <prefer>
	<family>DejaVu Sans Mono</family>
  </prefer>
</alias></fontconfig>
EOT
	cp -a $src/WebKitBuild/Release/bin/Qt* $fs/usr/bin
	cp -a $install/usr/lib/*.so* $fs/usr/lib
}
