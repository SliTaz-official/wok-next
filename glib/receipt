# SliTaz package receipt v2.

PACKAGE="glib"
VERSION="2.54.3"
CATEGORY="x-window"
SHORT_DESC="C routines"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://developer.gnome.org/glib/"
LFS="http://www.linuxfromscratch.org/blfs/view/stable/general/glib2.html"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNOME_MIRROR/$PACKAGE/${VERSION%.*}/$TARBALL"

BUILD_DEPENDS="meson ninja locale-en-base pcre-dev libffi-dev zlib-dev gettext \
util-linux-mount-dev libxml2-tools elfutils-dev dbus-dev libxslt docbook-xsl"
SPLIT="glib-dev"

compile_rules() {
	mkdir -p /usr/lib/locale
	localedef -i 'en_US' -c -f 'UTF-8' /usr/lib/locale/en_US.UTF-8
	export LC_ALL=en_US.UTF-8 LANG=en_US

	mkdir build-glib
	cd    build-glib

	meson-wrapper \
		-Dwith-pcre=system \
		-Dwith-docs=no \
		&&
	ninja &&
	ninja install || return 1

	# fix -rw-rw-r-- (0664) and -rwxrwxr-x (0775)
	find $install -type f -perm +020 -exec chmod g-w '{}' \;
	# fix gdbus-codegen and glib-gettextize permissions (was 0644)
	find $install/usr/bin -type f -exec chmod 0755 '{}' \;
}

genpkg_rules() {
	case $PACKAGE in
		glib)
			copy @std
			# Python codegen, tester, Perl mkenums --> glib-dev
			cd $fs/usr/bin
			rm gdbus-codegen gtester* glib-mkenums glib-gettextize
			rm -r $fs/usr/share
			DEPENDS="elfutils libffi libpcre util-linux-mount zlib"
			;;
		glib-dev)
			copy @std @dev @rm
			DEPENDS="glib glibc-dev libffi-dev pcre-dev python3 \
			util-linux-mount-dev zlib-dev perl"
			;;
	esac
}
