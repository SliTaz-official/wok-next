# SliTaz package receipt v2.

PACKAGE="lxsession"
VERSION="0.5.3"
CATEGORY="x-window"
SHORT_DESC="Standard session manager used by LXDE"
MAINTAINER="pankso@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://wiki.lxde.org/en/LXSession"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$SF_MIRROR/lxde/$TARBALL"

BUILD_DEPENDS="intltool xorg-libX11-dev polkit-dev vala libxslt docbook-xsl \
automake gtk+-dev"

# Rules to configure and make the package.
compile_rules()
{
	# http://www.linuxfromscratch.org/blfs/view/stable/lxde/lxsession.html

	# https://git.archlinux.org/svntogit/community.git/tree/trunk/PKGBUILD?h=packages/lxsession
	# Regenerate C sources from Vala code
	rm *.stamp
	autoreconf -fi

	./configure \
		--sysconfdir=/etc \
		$CONFIGURE_ARGS &&
	make && make install || return 1

	# customize desktop.conf for SliTaz
	confdir="$install/etc/xdg/lxsession/LXDE"
	mkdir -p $confdir
	cp $src/data/desktop.conf.example $confdir/desktop.conf
	sed -i '
		s|^\(terminal_manager/command\).*|\1=terminal|;
		s|^\(launcher_manager/command\).*|\1=lxpanelctl|;
		s|^\(window_manager\).*|\1=openbox|;
		s|^#*\(iXft/Hinting\)|\1=1|;
		s|^\(sNet/ThemeName\).*|\1=Paper|;
		s|^\(sNet/IconThemeName\).*|\1=SliTaz-Paper|;
		s|^\(sGtk/FontName\).*|\1=DejaVu Sans 10|;
		s|^#*\(iGtk/ToolbarIconSize\).*|\1=2|;
		s|^#*\(sGtk/CursorThemeName\).*|\1=slitaz-polar|;
		' $confdir/desktop.conf

	# change icon
	sed -i 's|^Icon=.*$|Icon=session-properties|' \
		$install/usr/share/applications/lxsession-edit.desktop

	# config files examples
	cp data/*.example $confdir

	# LXDE autostart file
	touch $confdir/autostart
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	copy @std
	DEPENDS="atk cairo fontconfig freetype gdk-pixbuf glib gtk+ pango polkit \
	xorg-libX11   dbus-glib lsb-release"
	PROVIDE="lxsession-edit"
	CONFIG_FILES="/etc/xdg/lxsession/LXDE/desktop.conf \
	/etc/xdg/lxsession/LXDE/conffiles.conf"
}
