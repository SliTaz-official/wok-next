# SliTaz package receipt v2.

PACKAGE="coreutils-multicall"
VERSION="8.25"
CATEGORY="system-tools"
SHORT_DESC="Utilities for using and setting the basic system"
MAINTAINER="al.bobylev@gmail.com"
LICENSE="GPL3"
WEB_SITE="https://www.gnu.org/software/coreutils/coreutils.html"

TARBALL="coreutils-$VERSION.tar.xz"
WGET_URL="$GNU_MIRROR/coreutils/$TARBALL"

SIBLINGS="coreutils"
BUILD_DEPENDS="automake autoconf gettext xz libcap-dev gmp-dev patch"

# Rules to configure and make the package.
compile_rules()
{
	# Rebuild fixed translations
	msgfmt po/nb.po -o po/nb.gmo
	msgfmt po/sl.po -o po/sl.gmo

	autoreconf -fi

	FORCE_UNSAFE_CONFIGURE=1 \
	./configure \
		--enable-single-binary=symlinks \
		$CONFIGURE_ARGS &&
	make && make install

	# LFS: Move programs to the locations specified by the FHS
	mkdir -p \
		$install/bin \
		$install/usr/sbin \
		$install/usr/share/man/man8
	for i in cat chgrp chmod chown cp date dd df echo false ln ls mkdir \
		mknod mv pwd rm rmdir stty sync true uname; do
		rm $install/usr/bin/$i
		ln -s /usr/bin/coreutils $install/bin/$i
	done
	rm $install/usr/bin/chroot
	ln -s /usr/bin/coreutils $install/usr/sbin/chroot
	mv  $install/usr/share/man/man1/chroot.1 \
		$install/usr/share/man/man8/chroot.8
	sed -i 's|"1"|"8"|' $install/usr/share/man/man8/chroot.8
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	copy @std
	DEPENDS="glibc-base acl attr libcap gmp"
}

	# Remove Busybox applets in order to not clash with ("/bin", "/sbin",
	# "/usr/bin" and "/usr/sbin" conflicts with the same filename)
post_install_coreutils_multicall()
{
	rm "$1/bin/base64"   # for /usr/bin/base64
	rm "$1/bin/kill"     # for /usr/bin/kill
	rm "$1/bin/mktemp"   # for /usr/bin/mktemp
	rm "$1/bin/nice"     # for /usr/bin/nice
	rm "$1/bin/printenv" # for /usr/bin/printenv
	rm "$1/bin/sleep"    # for /usr/bin/sleep
	rm "$1/bin/stat"     # for /usr/bin/stat
	rm "$1/bin/touch"    # for /usr/bin/touch
}
