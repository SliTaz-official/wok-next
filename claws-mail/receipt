# SliTaz package receipt v2.

PACKAGE="claws-mail"
VERSION="3.9.3"
CATEGORY="network"
SHORT_DESC="The user-firendly, lightweight and fast email client"
MAINTAINER="erjo@slitaz.org"
LICENSE="GPL3"
TARBALL="$PACKAGE-$VERSION.tar.bz2"
WEB_SITE="http://www.claws-mail.org/index.php"
WGET_URL="$SF_MIRROR/sylpheed-claws/$TARBALL"

BUILD_DEPENDS="libetpan-dev curl-dev gpgme-dev glib-dev libgpg-error-dev \
enchant libidn-dev db-dev expat-dev cyrus-sasl-dev xcb-util-dev gtk+-dev \
pkg-config libassuan libassuan-dev xorg-dev gnutls-dev libwebkit-dev curl-dev xorg-libXinerama-dev \
xorg-libXrandr-dev xorg-libXcursor-dev xorg-libXcomposite-dev \
xorg-libXdamage-dev libxslt-dev xorg-libXt-dev util-linux-uuid-dev \
python-dev pygtk-dev libarchive-dev attr-dev acl-dev liblzma-dev poppler-dev lcms-dev \
ghostscript-dev libgnome-keyring-dev dbus-dev"
SPLIT="claws-mail-acpinotifier claws-mail-addresskeeper claws-mail-archive \
claws-mail-attachwarner claws-mail-attremover claws-mail-bsfilter \
claws-mail-clamd claws-mail-dev claws-mail-fancy claws-mail-fetchinfo \
claws-mail-mailmbox claws-mail-newmail claws-mail-notification \
claws-mail-pdfviewer claws-mail-plugins claws-mail-python claws-mail-rssyl-dev \
claws-mail-rssyl claws-mail-spam_report claws-mail-tnefparse \
claws-mail-vcalendar"

# Rules to configure and make the package.
compile_rules()
{
	./configure \
	 	--disable-ldap \
	 	--disable-jpilot \
		$CONFIGURE_ARGS &&
	make && make install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
	claws-mail)
		TAGS="email client"
		DEPENDS="libetpan libdb libsasl libcurl gpgme enchant dbus \
			dbus-glib expat libgnutls gtk+ libgcrypt \
			startup-notification xorg-libICE xorg-libSM \
			xorg-libX11 xorg-libXau xorg-libXcomposite \
			xorg-libXcursor xorg-libXdmcp xorg-libXext \
			xorg-libXfixes xorg-libXinerama xorg-libXrandr \
			xorg-libXrender xorg-libXdamage gcc-lib-base libtasn1"
		mkdir -p $fs/usr/share \
			$fs/usr/lib/$PACKAGE/plugins
		cp -a $install/usr/bin $fs/usr
		cp -a $install/usr/share/icons $fs/usr/share
		;;
	claws-mail-acpinotifier)
		CAT="network|Enables mail notification via LEDs on some laptops (Acer, ASUS, Fujitsu, IBM). "
		DEPENDS="claws-mail"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/acpi_notifier.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-addresskeeper)
		CAT="network|Keeps all recipient addresses in an addressbook folder. "
		DEPENDS="claws-mail"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/address_keeper.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-archive)
		CAT="network|claws-mail archiving features"
		DEPENDS="claws-mail libarchive acl liblzma bzlib"
		mkdir -p $fs/usr/lib/claws-mail/plugins \
			$fs/usr/share/locale
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so  \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-attachwarner)
		CAT="network|Warn about missing attachment"
		DEPENDS="claws-mail"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-attremover)
		CAT="network|claws-mail plugin - Remove attachments from emails."
		DEPENDS="claws-mail xorg-libXdamage"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/att_remover.so $fs/usr/lib/claws-mail/plugins/
		;;
	claws-mail-bsfilter)
		CAT="network|Check all recieved message with BSFilter"
		DEPENDS="claws-mail"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-clamd)
		CAT="network|Scans recieved message with Clam AV"
		DEPENDS="claws-mail clamav"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-dev)
		CAT="development|The user-firendly, lightweight and fast email client dev files"
		DEPENDS="claws-mail gtk+-dev libetpan-dev gnutls-dev pkg-config"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/include $fs/usr
		cp -a $install/usr/lib/claws-mail/plugins/*.*a $fs/usr/lib/claws-mail/plugins/
		cp -a $install/usr/lib/pkgconfig $fs/usr/lib/
		;;
	claws-mail-fancy)
		CAT="network|Renders HTML e-mail using the WebKit library "
		DEPENDS="claws-mail libwebkit libcurl libsoup libarchive"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-fetchinfo)
		CAT="network|Inserts headers containing some download information."
		DEPENDS="claws-mail libwebkit libcurl libsoup"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-mailmbox)
		CAT="network|Handles mailboxes in mbox format."
		DEPENDS="claws-mail libwebkit libcurl libsoup"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-newmail)
		CAT="network|Claws Mail writes a msg header summary to a log file."
		DEPENDS="claws-mail libwebkit libcurl libsoup"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-notification)
		CAT="network|claws-mail plugin - mail notification."
		DEPENDS="claws-mail libnotify xorg-libXdamage"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so* $fs/usr/lib/claws-mail/plugins/
		;;
	claws-mail-pdfviewer)
		CAT="network|PDF viewer for Claws Mail."
		DEPENDS="claws-mail poppler "
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/pdf_viewer.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-plugins)
		CAT="network|Standart plugins for claws-mail."
		DEPENDS="claws-mail bogofilter xorg-libXdamage gcc-lib-base"
		mkdir -p $fs/usr/lib/claws-mail/plugins 
		cp -a $install/usr/lib/claws-mail/plugins/bogofilter.so $fs/usr/lib/claws-mail/plugins/
		cp -a $install/usr/lib/claws-mail/plugins/pgpcore.so $fs/usr/lib/claws-mail/plugins/
		cp -a $install/usr/lib/claws-mail/plugins/pgpinline.so $fs/usr/lib/claws-mail/plugins/
		cp -a $install/usr/lib/claws-mail/plugins/pgpmime.so $fs/usr/lib/claws-mail/plugins/
		cp -a $install/usr/lib/claws-mail/plugins/smime.so $fs/usr/lib/claws-mail/plugins/
		cp -a $install/usr/lib/claws-mail/plugins/spamassassin.so $fs/usr/lib/claws-mail/plugins/
		#cp -a $install/usr/lib/claws-mail/plugins/trayicon.so $fs/usr/lib/claws-mail/plugins/
		;;
	claws-mail-python)
		CAT="network|Python interface to Claws Mail' filtering mechanism."
		DEPENDS="claws-mail pygtk"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-rssyl-dev)
		CAT="development|RSS feed aggregator for Claws Mail dev files."
		DEPENDS="claws-mail curl libxml2"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/rssyl.*a* $fs/usr/lib/claws-mail/plugins/
		;;
	claws-mail-rssyl)
		CAT="network|RSS feed aggregator for Claws Mail."
		SUGGESTED="claws-mail-fancy"
		TAGS="rss newsfeed"
		DEPENDS="claws-mail curl libxml2 expat gtk+ xorg-libX11 \
			xorg-libXau xorg-libXcomposite xorg-libXcursor \
			xorg-libXdmcp xorg-libXext xorg-libXfixes \
			xorg-libXinerama xorg-libXrandr xorg-libXrender \
			xorg-libXdamage"
		mkdir -p $fs/usr/lib/claws-mail/plugins \
			$fs/usr/share/locale
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so $fs/usr/lib/claws-mail/plugins/
		cp -a $install/usr/share/locale/fr $fs/usr/share/locale
		;;
	claws-mail-spam_report)
		CAT="network|Reports spam to various places"
		DEPENDS="claws-mail libcurl"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/spamreport.so  \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-tnefparse)
		CAT="network|Enables Claws Mail reading application/ms-tnef attachments."
		DEPENDS="claws-mail "
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/tnef_parse.so \
			$fs/usr/lib/claws-mail/plugins
		;;
	claws-mail-vcalendar)
		CAT="network|claws-mail plugin - vcalendar messages support."
		DEPENDS="claws-mail curl xorg-libXdamage gnutls"
		mkdir -p $fs/usr/lib/claws-mail/plugins
		cp -a $install/usr/lib/claws-mail/plugins/${PACKAGE:11}.so $fs/usr/lib/claws-mail/plugins/
		;;
	esac
}

# Post installation custom.
post_install_claws_mail()
{
	[ -x "$1/usr/bin/gtk-update-icon-cache" ] &&
	  chroot "$1/" gtk-update-icon-cache -f -t /usr/share/icons/hicolor
}
