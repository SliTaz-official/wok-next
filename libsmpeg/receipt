# SliTaz package receipt v2.

PACKAGE="libsmpeg"
VERSION="399"
CATEGORY="development"
SHORT_DESC="MPEG decoding library"
MAINTAINER="claudinei@slitaz.org"
LICENSE="LGPL2"
WEB_SITE="http://icculus.org/smpeg"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
BRANCH="$VERSION"
WGET_URL="subversion|svn://svn.icculus.org/smpeg/trunk"

BUILD_DEPENDS="libsdl libsdl-dev gtk+-dev autoconf automake m4 subversion tar"
SPLIT="libsmpeg-dev"

compile_rules() {
	sed -i 's/ 0-1/(unsigned int)&/g' audio/hufftable.cpp
	chmod +x install-sh
	./autogen.sh
	./configure \
		--disable-gtk-player \
		$CONFIGURE_ARGS &&
	fix libtool &&
	make LDFLAGS+=-lstdc++ &&
	make DESTDIR=$DESTDIR install
}

genpkg_rules() {
	case $PACKAGE in
		libsmpeg)
			mkdir -p $fs/usr/lib
			cp -a $install/usr/lib/*.so* $fs/usr/lib
			DEPENDS="libsdl gcc-lib-base"
			;;
		*-dev)
			mkdir -p $fs/usr/bin $fs/usr/lib $fs/usr/share $fs/usr/include
			cp $install/usr/bin/smpeg-config $fs/usr/bin
			chmod +x $fs/usr/bin/smpeg-config
			cp -a $install/usr/include/smpeg $fs/usr/include
			cp -a $install/usr/lib/*.a $fs/usr/lib
			cp -a $install/usr/share/aclocal $fs/usr/share
			#fix aclocal warnings
			sed -i "s#(AM_PATH_SMPEG#([AM_PATH_SMPEG]#" $fs/usr/share/aclocal/smpeg.m4
			;;
	esac
}
