# SliTaz package receipt.

PACKAGE="linux-man"
VERSION="4.9.4"
KBASEVER="4.9"
CATEGORY="doc"
SHORT_DESC="The Linux Kernel man pages"
MAINTAINER="devel@slitaz.org"
LICENSE="GPL2"
WEB_SITE="https://www.kernel.org/"

TARBALL="linux-$KBASEVER.tar.xz"
WGET_URL="https://www.kernel.org/pub/linux/kernel/v4.x/$TARBALL"

BUILD_DEPENDS="python-sphinx perl xmlto util-linux-getopt docbook-xsl \
coreutils-operations findutils"
SIBLINGS="linux linux-api-headers linux-dev"

if [ "$KBASEVER" != "${VERSION%.0}" ]; then
	PATCH="$(dirname $WGET_URL)/patch-$VERSION.xz"
	EXTRA_SOURCE_FILES="$(basename $PATCH)"
fi

# Rules to configure and make the package.
compile_rules()
{
	# Update sources to the $VERSION using base sources ($KBASEVER) and patch
	if [ "$KBASEVER" != "${VERSION%.0}" ]; then
		[ -s $SRC/$(basename $PATCH) ] || wget $PATCH -O $SRC/$(basename $PATCH)
		# don't patch twice for `cook $PACKAGE --continue`
		if [ ! -f "done.patch-$VERSION" ]; then
			xzcat $SRC/$(basename $PATCH) | patch -Np1
			touch done.patch-$VERSION
		fi
	fi

	# Get and apply Aufs patches
	. $WOK/linux/stuff/tools/aufs-patches

	patch -p1 -i $stuff/installmandocs.patch

	make mandocs && make installmandocs
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cp -a $install/* $fs
}
