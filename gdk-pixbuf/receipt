# SliTaz package receipt v2.

PACKAGE="gdk-pixbuf"
VERSION="2.38.0"
CATEGORY="x-window"
SHORT_DESC="An image loading library for GTK+2"
MAINTAINER="slaxemulator@gmail.com"
LICENSE="GPL2"
WEB_SITE="https://www.gtk.org/"
LFS="http://www.linuxfromscratch.org/blfs/view/svn/x/gdk-pixbuf.html"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNOME_MIRROR/$PACKAGE/${VERSION%.*}/$TARBALL"

BUILD_DEPENDS="meson ninja glib-dev shared-mime-info-dev libpng16-dev \
libjpeg-turbo-dev tiff-dev gobject-introspection-dev xorg-libX11-dev gettext \
libxslt docbook-xsl libxml2-tools"
SPLIT="$PACKAGE-dev $PACKAGE"

compile_rules() {
	mkdir build
	cd    build

	meson-wrapper \
		-Dinstalled_tests=false \
		&&
	ninja &&
	ninja install || return 1

	touch $install/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
}

genpkg_rules() {
	case $PACKAGE in
		*-dev)
			copy @dev gdk-pixbuf-csource
			DEPENDS="gdk-pixbuf glib-dev shared-mime-info-dev xorg-libX11-dev"
			# gdk-pixbuf-csource use shared-mime-info to detect the image file format
			;;
		*)
			copy @std @rm
			DEPENDS="glib libjpeg-turbo libpng16 tiff xorg-libX11"
			;;
	esac
}

# Updating gdk pixbuf loaders cache file...
post_install_gdk_pixbuf() {
	chroot "$1/" /usr/bin/gdk-pixbuf-query-loaders > /usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
}
