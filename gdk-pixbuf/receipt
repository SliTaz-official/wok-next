# SliTaz package receipt v2.

PACKAGE="gdk-pixbuf"
VERSION="2.36.5"
CATEGORY="x-window"
SHORT_DESC="An image loading library for GTK+2"
MAINTAINER="slaxemulator@gmail.com"
LICENSE="GPL2"
WEB_SITE="http://www.gtk.org/"
HOST_ARCH="i486 arm"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="$GNOME_MIRROR/$PACKAGE/${VERSION%.*}/$TARBALL"

BUILD_DEPENDS="glib-dev gettext tiff-dev libpng16-dev libjpeg-turbo-dev \
xorg-libX11-dev gobject-introspection-dev gtk-doc util-linux-mount-dev"
BUILD_DEPENDS_arm="glib-dev gettext tiff-dev libpng16-dev libjpeg-turbo-dev \
xorg-libX11-dev gtk-doc"
SPLIT="gdk-pixbuf-dev"

# Rules to configure and make the package.
compile_rules()
{
	case "$ARCH" in
		arm)
			ARCH_ARGS="--enable-introspection=no --cache-file=arm.cache"
			echo "gio_can_sniff=yes" > arm.cache
			;;
	esac

	./configure \
		--with-x11 \
		$CONFIGURE_ARGS $ARCH_ARGS &&
	make && make install &&

	mkdir -p $install/usr/lib/gdk-pixbuf-2.0/2.10.0 &&
	touch    $install/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		gdk-pixbuf)
			copy @std
			DEPENDS="glib libffi libgio libjpeg-turbo libpng16 libxcb pcre \
			tiff util-linux-blkid util-linux-mount util-linux-uuid xorg-libX11 \
			xorg-libXau xorg-libXdmcp zlib"
			;;
		*-dev)
			copy @dev
			DEPENDS="gdk-pixbuf glib-dev libjpeg-turbo-dev libffi-dev \
			libgio-dev libpng16-dev libxcb-dev pcre-dev tiff-dev \
			util-linux-blkid-dev util-linux-mount-dev util-linux-uuid-dev \
			xorg-libX11-dev xorg-libXau-dev xorg-libXdmcp-dev zlib-dev"
			;;
	esac
}

# Updating gdk pixbuf loaders cache file...
post_install_gdk_pixbuf() {
	chroot "$1/" /usr/bin/gdk-pixbuf-query-loaders --update-cache
}
