# SliTaz package receipt v2.

PACKAGE="perl"
VERSION="5.28.0"
CATEGORY="development"
SHORT_DESC="Perl interpreter and modules"
MAINTAINER="devel@slitaz.org"
LICENSE="GPL"
WEB_SITE="https://www.perl.org/"
LFS="http://www.linuxfromscratch.org/lfs/view/stable/chapter06/perl.html"

# WARNING
# Due to Perl libraries use versioned paths like
#   /usr/lib/perl5/$VERSION/
#   /usr/lib/perl5/site_perl/$VERSION/
# etc., you need to update ALL the Perl related packages on ANY change
# of the Perl version!

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="http://www.cpan.org/src/5.0/$TARBALL"
# Integrity check: http://www.cpan.org/src/5.0/
TARBALL_SHA256="059b3cb69970d8c8c5964caced0335b4af34ac990c8e61f7e3f90cd1c2d11e49"

COOKOPTS="!perlz"
BUILD_DEPENDS="zlib-dev bzip2-dev less gdbm-dev"
SPLIT="$PACKAGE-core $PACKAGE $PACKAGE-dev"

compile_rules() {
	export BUILD_ZLIB=False
	export BUILD_BZIP2=0
	sh Configure -des \
		-Dprefix=/usr \
		-Dvendorprefix=/usr \
		-Dman1dir=/usr/share/man/man1 \
		-Dman3dir=/usr/share/man/man3 \
		-Dpager="/usr/bin/less -isR" \
		-Duseshrplib \
		-Dusethreads &&
	make &&
	make install
}

genpkg_rules() {
	case $PACKAGE in
		perl-core)
			copy perl perl$VERSION libperl.so
			DEPENDS="glibc-base"
			CAT="development|minimal interpreter"
			;;
		perl)
			copy @std @rm
			DEPENDS="bzlib gdbm zlib perl-core"
			PROVIDE="microperl"
			TAGS="LFS"
			;;
		*-dev)
			copy @dev
			;;
	esac
}

# Remove perl link to microperl if any.
pre_install_perl_core() {
	rm -f "$1/usr/bin/perl"
}
