# SliTaz package receipt v2.

PACKAGE="file"
VERSION="5.35"
CATEGORY="system-tools"
SHORT_DESC="Determines file type using 'magic' numbers"
MAINTAINER="devel@slitaz.org"
LICENSE="BSD"
WEB_SITE="https://github.com/file/file"
LFS="http://www.linuxfromscratch.org/lfs/view/development/chapter06/file.html"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="https://github.com/file/file/archive/FILE${VERSION/./_}.tar.gz"

BUILD_DEPENDS="automake libtool zlib-dev python python3"
SPLIT="libmagic libmagic-dev python-magic python3-magic"

compile_rules() {
	autoreconf -f -i &&
	./configure \
		--libdir=/usr/lib \
		$CONFIGURE_ARGS &&
	fix libtool &&
	make &&
	make install || return 1

	rmdir --ignore-fail-on-non-empty $install/usr/share/man/man5/

	cd python
	python  -B setup.py build &&
	python  -B setup.py install --root=$install || return 1

	python3 -B setup.py build &&
	python3 -B setup.py install --root=$install

}

# Be sure it as cross compile.
testsuite() {
	readelf -h $install/usr/bin/file
}

genpkg_rules() {
	case $PACKAGE in
		file)
			copy file magic.mgc
			DEPENDS="libmagic"
			TAGS="LFS"
			;;
		libmagic)
			copy *.so*
			CAT="libs|library"
			DEPENDS="zlib"
			;;
		libmagic-dev)
			copy @dev
			DEPENDS="libmagic"
			;;
		python-magic)
			copy python2*/
			CAT="development|Python bindings"
			DEPENDS="file python"
			;;
		python3-magic)
			copy python3*/
			CAT="development|Python bindings"
			DEPENDS="file python"
			;;
	esac
}
