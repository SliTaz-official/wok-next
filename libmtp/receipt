# SliTaz package receipt v2.

PACKAGE="libmtp"
VERSION="1.1.13"
CATEGORY="system-tools"
SHORT_DESC="Access to MTP devices: mp3 players, Android phones"
MAINTAINER="keupont@no-log.org"
LICENSE="LGPL2.1"
WEB_SITE="http://libmtp.sourceforge.net/"

TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="$SF_MIRROR/$PACKAGE/$TARBALL"

BUILD_DEPENDS="libusb-dev libgcrypt-dev"
SPLIT="mtp-tools libmtp-dev"

compile_rules() {
	./configure \
		--with-udev=/etc/udev \
		$CONFIGURE_ARGS &&
	fix libtool &&
	make &&
	make install || return 1

	# udev rules in /etc/udev/rules.d/; udev execs in /lib/udev/
	mkdir -p $install/lib/udev
	mv $install/etc/udev/mtp-probe $install/lib/udev
	sed -i 's#/etc/udev/mtp-probe#/lib/udev/mtp-probe#' \
		$install/etc/udev/rules.d/69-libmtp.rules
}

genpkg_rules() {
	case $PACKAGE in
		libmtp)
			copy udev/ *.so*
			DEPENDS="eudev libgcrypt libgpg-error libusb"
			CAT="system-tools|library"
			;;
		*-tools)
			copy bin/
			CAT="system-tools|utilities"
			;;
		*-dev)
			copy @dev
			DEPENDS="libmtp mtp-tools \
			eudev-dev libgcrypt-dev libgpg-error-dev libusb-dev"
			;;
	esac
}
