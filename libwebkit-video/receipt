# SliTaz package receipt v2.

PACKAGE="libwebkit-video"
VERSION="1.8.3"
CATEGORY="network"
SHORT_DESC="xHTML render library."
MAINTAINER="mallory@sweetpeople.org"
LICENSE="LGPL2"
SOURCE="webkit"
TARBALL="$SOURCE-$VERSION.tar.xz"
WEB_SITE="http://webkitgtk.org"
WGET_URL="$WEB_SITE/releases/$TARBALL"

BUILD_DEPENDS="gtk+-dev enchant enchant-dev gperf libxslt-dev jpeg-dev \
libpng16-dev glib-dev autoconf automake gnutls-dev sqlite3-dev libtool \
m4 bison flex xorg-libXdamage-dev acl-dev libsoup-dev libxml2-dev \
xorg-libxcb-dev xorg-xcb-util-dev util-linux-uuid-dev zlib-dev libtasn1-dev \
gobject-introspection-dev tar gettext glib-networking gtk-doc \
xorg-libXt gstreamer0-dev gst0-plugins-base-dev"
SPLIT="libwebkit-video libwebkit-video-dev"
SUGGESTED="gst0-plugins-good gst0-plugins-bad gst0-plugins-ugly gst0-ffmpeg"

compile_rules() {
	# libwebkit does not like parallel builds.
	export MAKEFLAGS=$(echo $MAKEFLAGS | sed 's/-j[0-9]*/-j1/')
	touch Documentation/webkitgtk/version.xml

	# Build
	./configure \
		--prefix=/usr \
		--infodir=/usr/share/info \
		--mandir=/usr/share/man \
		--enable-introspection=no \
		--enable-video=yes \
		--enable-jit=yes \
		--disable-webgl \
		--disable-geolocation \
		--with-unicode-backend=glib \
		--with-gtk=2.0 \
		--disable-webkit2 \
		--disable-gtk-doc-html \
		$CONFIGURE_ARGS &&
	fix libtool &&
	make all stamp-po 2>&1 | grep -v Source/WebCore/dom/testing && 
	make DESTDIR=$DESTDIR install 2>&1 | grep -v /usr/share/gtk-doc/html/ &&
	cp -a $src/Programs/GtkLauncher $DESTDIR/usr/bin
}

genpkg_rules() {
	case $PACKAGE in
	libwebkit-video)
		PROVIDE="libwebkit"
		DEPENDS="gtk+ enchant libxslt expat gtk+ jpeg libpng16 libxml2 \
			sqlite3 xorg-libICE xorg-libSM xorg-libX11 xorg-libXau \
			xorg-libXcomposite xorg-libXcursor xorg-libXdmcp \
			xorg-libXext xorg-libXfixes xorg-libXinerama \
			xorg-libXrandr xorg-libXrender xorg-libXt acl \
			xorg-libXdamage libsoup gcc-lib-base libtasn1 \
			util-linux-uuid glib-networking gst0-plugins-base"
		mkdir -p $fs/usr/lib $fs/usr/bin
		[ -d $install/usr/lib/girepository-1.0 ] &&
			cp -a $install/usr/lib/girepository-1.0 $fs/usr/lib
		cp -a $install/usr/lib/*.so* $fs/usr/lib
		;;
	libwebkit-video-dev)
		CAT="development|devel files for libwebkit"
		DEPENDS="libwebkit-video libsoup-dev enchant-dev libtasn1-dev \
			sqlite3-dev"
		mkdir -p $fs/usr/lib $fs/usr/share
		cp -a $install/usr/lib/*.*a $fs/usr/lib
		cp -a $install/usr/lib/pkgconfig $fs/usr/lib
		cp -a $install/usr/include $fs/usr
		[ -d $install/usr/share/gir-1.0 ] &&
			cp -a $install/usr/share/gir-1.0 $fs/usr/share
		if [ -f $fs/usr/lib/pkgconfig/webkit-1.0.pc ]; then
			ln -sf /usr/lib/pkgconfig/webkit-1.0.pc \
				$fs/usr/lib/pkgconfig/webkitgtk-1.0.pc
		fi
		;;
	esac
}
