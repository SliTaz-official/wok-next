# SliTaz package receipt v2.

PACKAGE="fontconfig"
VERSION="2.12.4"
CATEGORY="x-window"
SHORT_DESC="Font configuration utilities and library"
MAINTAINER="pankso@slitaz.org"
LICENSE="MIT"
WEB_SITE="https://www.freedesktop.org/wiki/Software/fontconfig/"

TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="http://www.freedesktop.org/software/fontconfig/release/$TARBALL"

BUILD_DEPENDS="libxml2-dev freetype-dev gperf"
SPLIT="fontconfig-dev"

compile_rules() {
	rm -f src/fcobjshash.h

	./configure \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--with-arch=$ARCH \
		--disable-static \
		--enable-iconv \
		--enable-libxml2 \
		--disable-docs \
		$CONFIGURE_ARGS &&
	make &&
	make DESTDIR=$install install || return 1


	# FIXME: Which the app uses the next?
	# FIXME: There are 10-hinting-{full,medium,none,slight}.conf already exists...
	cd $install/usr/share/fontconfig/conf.avail
	for h in hintslight hintmedium hintfull; do
		cat > 10-hintstyle-$h.conf <<EOT
<match target="font">
	<edit mode="append" name="hintstyle">
		<const>${h}</const>
	</edit>
</match>
EOT
	done

	ln -s /usr/share/fontconfig/conf.avail/11-lcdfilter-default.conf \
		$install/etc/fonts/conf.d

	# Fontconfig warning: "/etc/fonts/conf.d/50-user.conf", line 14: reading
	# configurations from ~/.fonts.conf is deprecated.
	sed -i '/~\/\.fonts\.conf</d' \
		$install/usr/share/fontconfig/conf.avail/50-user.conf

	# chown -R root.root $fs
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
		fontconfig)
			copy @std
			DEPENDS="bzlib freetype liblzma liblzma libpng16 libxml2 zlib"
			;;
		fontconfig-dev)
			copy @dev
			DEPENDS="fontconfig freetype-dev libpng16-dev libxml2-dev"
			;;
	esac
}
