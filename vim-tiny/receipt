# SliTaz package receipt.

PACKAGE="vim-tiny"
VERSION="7.4"
CATEGORY="editors"
SHORT_DESC="Advanced text editor with no GUI"
MAINTAINER="erjo@slitaz.org"
LICENSE="other"
WEB_SITE="http://www.vim.org/"
CONFIG_FILES="/etc/vim/vimrc"
TAGS="text-editor"

TARBALL="vim-$VERSION.tar.bz2"
WGET_URL="ftp://ftp.vim.org/pub/vim/unix/$TARBALL"

DEPENDS="ncurses"
BUILD_DEPENDS="ncurses-dev"

# Rules to configure and make the package.
compile_rules()
{
	echo '#define SYS_VIMRC_FILE "/etc/vimrc"' >> src/feature.h

	./configure --prefix=/usr \
		--with-features=tiny \
		--without-x \
		--disable-gui \
		--enable-multibyte \
		--with-vim-name=$PACKAGE \
		--disable-acl \
		$CONFIGURE_ARGS &&
	make && make install

	mkdir -p $DESTDIR/etc/vim
	cp -a $src/runtime/vimrc_example.vim $DESTDIR/etc/vim/vimrc

	mkdir -p $install/usr/share/doc
	mv $install/usr/share/vim/vim*/doc $install/usr/share/doc/$PACKAGE-$VERSION
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cook_copy_folders etc bin vim
	rm -f  $fs/usr/bin/*tutor
	rm -rf $fs/usr/share/vim/vim*/tutor
}

post_install()
{
	cmd=$(readlink "$1/bin/vi")
	if [ "$cmd" != '/usr/bin/vim' ]; then
		echo
		echo "**** Actual VI link : $cmd"
		echo
		echo -n 'Do you want vim  for /bin/vi (y/N)? : '; read -t 30 anser
		if [ "$anser" == 'y' ]; then
			echo
			action 'Removing vi link to make a new one pointing on /usr/bin/vim...'
			rm "$1/bin/vi" && ln -sf /usr/bin/vim-tiny "$1/bin/vi"
			status
		else
			echo
			echo "Leaving /bin/vi to $cmd"
		fi
	fi
}

post_remove()
{
	# restore previous symlink
	ln -sf /bin/busybox "$1/bin/vi"
}
