# SliTaz package receipt v2.

PACKAGE="ndiswrapper-driver"
VERSION="1.61"
EXTRAVERSION="_$kvers"
CATEGORY="system-tools"
SHORT_DESC="Add Windows network drivers support to Linux kernel."
MAINTAINER="erjo@slitaz.org"
LICENSE="GPL"
SOURCE="ndiswrapper"
TARBALL="$SOURCE-$VERSION.tar.gz"
WEB_SITE="http://ndiswrapper.sourceforge.net/joomla/"
WGET_URL="$SF_MIRROR/$SOURCE/stable/$TARBALL"
TAGS="windows wireless network"

BUILD_DEPENDS="linux-module-headers xz"
SPLIT="ndiswrapper-driver ndiswrapper-utils ndiswrapper"

# Rules to configure and make the package.
compile_rules()
{
	make KBUILD=/usr/src/linux KVER=linux-${kvers}-slitaz
	xz driver/ndiswrapper.ko
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
	ndiswrapper-driver)
		DEPENDS="linux"
		mkdir -p $fs/usr/sbin $fs/sbin $fs/lib/modules/${kvers}-slitaz/kernel/misc

		# Install utilities
		install -o root -m 0755 $src/utils/loadndisdriver $fs/sbin/
		install -o root -m 0644 $src/driver/ndiswrapper.ko.xz \
			$fs/lib/modules/${kvers}-slitaz/kernel/misc/ndiswrapper.ko.xz
		;;
	ndiswrapper-utils)
		CAT="system-tools|utilities"
		DEPENDS="ndiswrapper-driver perl"
		mkdir -p $fs/usr/sbin $fs/sbin 
		# Install utilities	
		install -o root -m 755 $src/utils/ndiswrapper $fs/usr/sbin/
		install -o root -m 755 $src/utils/ndiswrapper-buginfo $fs/usr/sbin/
		;;
	ndiswrapper)
		CATEGORY="meta"
		DEPENDS="ndiswrapper-driver ndiswrapper-utils wireless_tools"
		mkdir -p $fs/usr/sbin $fs/sbin 
		;;
	esac
}
