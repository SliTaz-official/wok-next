# SliTaz package receipt v2.

PACKAGE="rsh-redone"
VERSION="85"
CATEGORY="network"
SHORT_DESC="Reimplementation of rsh and rlogin"
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="GPL"
WEB_SITE="https://packages.debian.org/source/sid/rsh-redone"

TARBALL="${PACKAGE}_$VERSION.orig.tar.gz"
WGET_URL="http://ftp.de.debian.org/debian/pool/main/${PACKAGE:0:1}/$PACKAGE/$TARBALL"

BUILD_DEPENDS="pam-dev"
SPLIT="rshd-redone"

compile_rules() {
	make &&
	make DESTDIR=$install install
}

genpkg_rules() {
	case $PACKAGE in
		rsh-redone)
			mkdir -p $fs/usr
			cp -a $install/usr/bin $fs/usr
			PROVIDE="rsh rlogin"
			;;
		rshd-redone)
			mkdir -p $fs/usr $fs/etc/skel
			cp -a $install/usr/sbin $fs/usr
			cp -a $install/usr/etc $fs
			touch $fs/etc/skel/.rhosts
			chmod 600 $fs/etc/skel/.rhosts
			CAT="network|rshd and rlogind"
			DEPENDS="pam"
			PROVIDE="rshd:pam rshd-pam"
			;;
	esac
}

# Pre and post install commands for Tazpkg.
post_install_rshd-redone()
{
	if ! grep -qs rlogind $1/etc/inetd.conf; then
		cat >> $1/etc/inetd.conf <<EOT
login	stream  tcp     nowait  root    /usr/sbin/in.rlogind	rlogind
shell	stream  tcp     nowait  root    /usr/sbin/in.rshd	rshd
EOT
		[ -n "$1" ] || killall -HUP inetd
	fi
}

# Pre and post install commands for Tazpkg.
pre_remove_rshd-redone()
{
	sed -i '/rlogind/d;/rshd/d' $1/etc/inetd.conf
	[ -n "$1" ] || killall -HUP inetd
}
