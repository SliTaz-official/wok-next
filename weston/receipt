# SliTaz package receipt v2.

PACKAGE="weston"
VERSION="1.4.0"
CATEGORY="x-window"
SHORT_DESC="Reference implementation of a Wayland compositor"
MAINTAINER="devel@slitaz.org"
LICENSE="MIT"
WEB_SITE="https://wayland.freedesktop.org/"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="http://wayland.freedesktop.org/releases/$TARBALL"

BUILD_DEPENDS="wayland-dev mesa-dev cairo-gl-dev libxkbcommon-dev \
libunwind-dev mtdev-dev xorg-libXcursor-dev pam-dev xz-dev \
gegl-dev libdrm-dev xorg-libXxf86vm-dev eudev-dev libjpeg-turbo-dev expat-dev \
xorg-libxshmfence-dev"
SPLIT="$PACKAGE-dev"

compile_rules() {
	./configure \
		--prefix=/usr \
		--libexec=/usr/lib/weston \
		--disable-documentation \
		--enable-fbdev-compositor &&
	fix libtool &&
	make &&
	make install || return 1

	# Custom weston-session
	cp -f $stuff/weston-session $install/usr/bin
}

genpkg_rules() {
	case $PACKAGE in
		weston)
			copy @std
			DEPENDS="cairo-gl eudev libdrm libjpeg-turbo libpng16 libunwind \
			libxkbcommon-wayland mesa mesa-libegl mesa-libgbm \
			mesa-libwayland-egl mtdev pam wayland xorg-libX11 xorg-libXcursor \
			xorg-libxcb xorg-pixman"
			;;
		*-dev)
			copy @dev
			;;
	esac
}
