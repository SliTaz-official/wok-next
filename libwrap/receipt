# SliTaz package receipt v2.

PACKAGE="libwrap"
VERSION="7.6"
CATEGORY="system-tools"
SHORT_DESC="Wietse Venema's network logger."
MAINTAINER="erjo@slitaz.org"
LICENSE="BSD"
SOURCE="tcp_wrappers"
TARBALL="${SOURCE}_${VERSION}.tar.gz"
WEB_SITE="ftp://ftp.porcupine.org/pub/security/index.html"
WGET_URL="ftp://ftp.porcupine.org/pub/security/$TARBALL"
HOST_ARCH="i486 arm"

SPLIT="libwrap libwrap-dev tcpd"

# Rules to configure and make the package.
compile_rules()
{
	# Patch from Linux From Scratch
	[ -f done.tcp_wrappers-7.6-shared_lib_plus_plus-1.patch ] ||
	patch -p1 -i $stuff/tcp_wrappers-7.6-shared_lib_plus_plus-1.patch
	touch done.tcp_wrappers-7.6-shared_lib_plus_plus-1.patch
	sed -i -e "s,^extern char \*malloc();,/* & */," scaffold.c 
		
	make REAL_DAEMON_DIR=/usr/sbin STYLE=-DPROCESS_OPTIONS linux
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	case $PACKAGE in
	libwrap)
		mkdir -p $fs/usr/lib 
		cp -a $src/shared/*.so* $fs/usr/lib
		;;
	libwrap-dev)
		CAT="development|Wietse Venema's network logger devel files."
		mkdir -p $fs/usr/include $fs/usr/lib
		cp -a $src/tcpd.h $fs/usr/include
		cp -a $src/*.a $fs/usr/lib
		;;
	tcpd)
		CAT="development|Wietse Venema's network encapsulation files."
		CONFIG_FILES="/etc/hosts.allow /etc/hosts.deny"
		DEPENDS="libwrap"
		mkdir -p $fs/usr/sbin $fs/etc
		cp -a $src/tcpd $fs/usr/sbin
		cp -a $src/tcpdchk $fs/usr/sbin
		cp -a $src/tcpdmatch $fs/usr/sbin
		cp -a $src/try-from $fs/usr/sbin
		cp -a $src/safe_finger $fs/usr/sbin
		echo "ALL : 127.0.0.1, 192.168." > $fs/etc/hosts.allow
		touch $fs/etc/hosts.deny
		;;
	esac
}

clean_wok()
{
	rm -rf $PWD/${SOURCE}_${VERSION}
}
